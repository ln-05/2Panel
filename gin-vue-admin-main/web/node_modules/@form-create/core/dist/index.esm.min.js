/*!
 * @form-create/core v3.2.27
 * (c) 2018-2025 xaboy
 * Github https://github.com/xaboy/form-create
 * Released under the MIT License.
 */
import{isVNode as e,defineComponent as t,getCurrentInstance as n,provide as r,inject as i,toRefs as a,reactive as o,onBeforeMount as u,watchEffect as c,onMounted as l,onBeforeUnmount as f,onUpdated as s,watch as d,nextTick as p,markRaw as h,computed as v,toRef as m,createVNode as g,resolveComponent as y,withDirectives as b,resolveDirective as _,createApp as $,h as x,ref as O}from"vue";function C(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function S(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?C(Object(n),!0).forEach((function(t){E(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):C(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function j(e){return j="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},j(e)}function F(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function E(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function w(e){return w=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)},w(e)}function D(e,t){return D=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e},D(e,t)}function k(e,t){if(t&&("object"==typeof t||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e)}function A(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=w(e);if(t){var i=w(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return k(this,n)}}function R(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null==n)return;var r,i,a=[],o=!0,u=!1;try{for(n=n.call(e);!(o=(r=n.next()).done)&&(a.push(r.value),!t||a.length!==t);o=!0);}catch(e){u=!0,i=e}finally{try{o||null==n.return||n.return()}finally{if(u)throw i}}return a}(e,t)||P(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function V(e){return function(e){if(Array.isArray(e))return L(e)}(e)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(e)||P(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function P(e,t){if(e){if("string"==typeof e)return L(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?L(e,t):void 0}}function L(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function N(e){return Array.isArray(e)?e:[null,void 0,""].indexOf(e)>-1?[]:[e]}function T(e,t){var n=null;return function(){for(var r=this,i=arguments.length,a=new Array(i),o=0;o<i;o++)a[o]=arguments[o];null!==n&&clearTimeout(n),n=setTimeout((function(){return e.call.apply(e,[r].concat(a))}),t)}}function I(e){var t=e.replace(/([A-Z])/g,"-$1").toLocaleLowerCase();return 0===t.indexOf("-")&&(t=t.substr(1)),t}function M(e){return e.replace(e[0],e[0].toLocaleUpperCase())}function q(e,t,n){e[t]=n}function U(e,t){delete e[t]}var B={type:function(e,t){return Object.prototype.toString.call(e)==="[object "+t+"]"},Undef:function(e){return null==e},Element:function(e){return"object"===j(e)&&null!==e&&1===e.nodeType&&!B.Object(e)},trueArray:function(e){return Array.isArray(e)&&e.length>0},Function:function(e){var t=this.getType(e);return"Function"===t||"AsyncFunction"===t},getType:function(e){var t=Object.prototype.toString.call(e);return/^\[object (.*)\]$/.exec(t)[1]},empty:function(e){return null==e||(!(!Array.isArray(e)||!Array.isArray(e)||e.length)||"string"==typeof e&&!e)}};function G(e,t){return{}.hasOwnProperty.call(e,t)}function H(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=arguments.length>2?arguments[2]:void 0,r=!1;for(var i in t)if(Object.prototype.hasOwnProperty.call(t,i)){var a=t[i];if((r=Array.isArray(a))||B.Object(a)){var o=void 0===e[i];if(r)r=!1,o&&q(e,i,[]);else if(a._clone&&void 0!==n){if(!n){q(e,i,a._clone());continue}a=a.getRule(),o&&q(e,i,{})}else o&&q(e,i,{});e[i]=H(e[i],a,n)}else q(e,i,a),B.Undef(a)||(B.Undef(a.__json)||(e[i].__json=a.__json),B.Undef(a.__origin)||(e[i].__origin=a.__origin))}return void 0!==n&&Array.isArray(e)?e.filter((function(e){return!e||!e.__ctrl})):e}function J(e){return H({},{value:e}).value}["Date","Object","String","Boolean","Array","Number"].forEach((function(e){B[e]=function(t){return B.type(t,e)}}));var W=["props"],z=["class","style","directives"],K=["on","hook"],X=function e(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},i=[].concat(W,V(r.normal||[])),a=[].concat(z,V(r.array||[])),o=[].concat(K,V(r.functional||[])),u=r.props||[];return t.reduce((function(t,n){for(var r in n)if(t[r])if(u.indexOf(r)>-1)t[r]=e([n[r]],t[r]);else if(i.indexOf(r)>-1)t[r]=S(S({},t[r]),n[r]);else if(a.indexOf(r)>-1){var c=t[r]instanceof Array?t[r]:[t[r]],l=n[r]instanceof Array?n[r]:[n[r]];t[r]=[].concat(V(c),V(l))}else if(o.indexOf(r)>-1)for(var f in n[r])if(t[r][f]){var s=t[r][f]instanceof Array?t[r][f]:[t[r][f]],d=n[r][f]instanceof Array?n[r][f]:[n[r][f]];t[r][f]=[].concat(V(s),V(d))}else t[r][f]=n[r][f];else if("hook"===r)for(var p in n[r])t[r][p]?t[r][p]=Z(t[r][p],n[r][p]):t[r][p]=n[r][p];else t[r]=n[r];else i.indexOf(r)>-1||o.indexOf(r)>-1||u.indexOf(r)>-1?t[r]=S({},n[r]):a.indexOf(r)>-1?t[r]=n[r]instanceof Array?V(n[r]):"object"===j(n[r])?S({},n[r]):n[r]:t[r]=n[r];return t}),n)},Z=function(e,t){return function(){e&&e.apply(this,arguments),t&&t.apply(this,arguments)}},Q=["type","slot","ignore","emitPrefix","value","name","native","hidden","display","inject","options","emit","link","prefix","suffix","update","sync","optionsTo","key","slotUpdate","computed","preview","component","cache","modelEmit"],Y=["validate","children","control"],ee=["effect","deep","renderSlots"];function te(){return[].concat(Q,V(W),V(z),V(K),Y,ee)}function ne(e,t,n){return"[form-create ".concat(e,"]: ").concat(t)+(n?"\n\nrule: "+JSON.stringify(n.getRule?n.getRule():n):"")}function re(e,t){console.error(ne("err",e,t))}function ie(e){return ae(e.replace(/(-[a-z])/g,(function(e){return e.replace("-","").toLocaleUpperCase()})))}function ae(e){return e.replace(e[0],e[0].toLowerCase())}var oe="[[FORM-CREATE-PREFIX-",ue="-FORM-CREATE-SUFFIX]]";function ce(e,t){return JSON.stringify(H(Array.isArray(e)?[]:{},e,!0),(function(e,t){if(!t||!0!==t._isVue){if("function"!=typeof t)return t;if(t.__json)return t.__json;if(t.__origin&&(t=t.__origin),!t.__emit)return oe+t+ue}}),t)}function le(e){return new Function("return "+e)()}function fe(e,t){if(e&&B.String(e)&&e.length>4){var n=e.trim(),r=!1;try{if(n.indexOf(ue)>0&&0===n.indexOf(oe))n=n.replace(ue,"").replace(oe,""),r=!0;else if(0===n.indexOf("$FN:"))n=n.substring(4),r=!0;else if(0===n.indexOf("$EXEC:"))n=n.substring(6),r=!0;else{if(0===n.indexOf("$GLOBAL:")){var i=n.substring(8);return n=function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];var r=t[0].api.getGlobalEvent(i);if(r)return r.call.apply(r,[this].concat(t))},n.__json=e,n.__inject=!0,n}if(0===n.indexOf("$FNX:"))return(n=le("function($inject){\n"+n.substring(5)+"\n}")).__json=e,n.__inject=!0,n;(t||0!==n.indexOf("function ")||"function "===n)&&(t||0!==n.indexOf("function(")||"function("===n)||(r=!0)}if(!r)return e;var a;try{a=le(n)}catch(e){a=le("function "+n)}return a.__json=e,a}catch(e){return void re("解析失败:".concat(n,"\n\nerr: ").concat(e))}}return e}function se(e,t){return JSON.parse(e,(function(e,n){return B.Undef(n)||!n.indexOf?n:fe(n,t)}))}function de(e,t){return{value:e,enumerable:!1,configurable:!1,writable:!!t}}function pe(e,t){return he([e],t||!1)[0]}function he(e,t){return H([],V(e),t||!1)}function ve(e,t){return X(Array.isArray(t)?t:[t],e,{array:Y,normal:ee}),e}function me(e){var t=B.Function(e.getRule)?e.getRule():e;return t.type||(t.type="input"),t}function ge(e,t){Object.defineProperties(e,Object.keys(t).reduce((function(e,n){return e[n]={get:function(){return t[n]()}},e}),{}))}function ye(e){return e.__fc__||(e.__origin__?e.__origin__.__fc__:null)}function be(e,t){try{t=e()}catch(e){!function(e){re(e.toString()),console.error(e)}(e)}return t}function _e(){var t={},n=function(e){return e||"default"};return{setSlot:function(e,r){e=n(e),!r||Array.isArray(r)&&r.length||(t[e]||(t[e]=[]),t[e].push(r))},getSlot:function(e,r){e=n(e);var i=[];return(t[e]||[]).forEach((function(e){if(Array.isArray(e))i.push.apply(i,V(e));else if(B.Function(e)){var t=e.apply(void 0,V(r||[]));Array.isArray(t)?i.push.apply(i,V(t)):i.push(t)}else B.Undef(e)||i.push(e)})),i},getSlots:function(){var e=this,n={};return Object.keys(t).forEach((function(t){n[t]=function(){for(var n=arguments.length,r=new Array(n),i=0;i<n;i++)r[i]=arguments[i];return e.getSlot(t,r)}})),n},slotLen:function(e){return e=n(e),t[e]?t[e].length:0},mergeBag:function(t){var n=this;if(!t)return this;var r=B.Function(t.getSlots)?t.getSlots():t;return Array.isArray(t)||e(t)?this.setSlot(void 0,(function(){return t})):Object.keys(r).forEach((function(e){n.setSlot(e,r[e])})),this}}}function $e(e){var t=S({},e.props||{});return Object.keys(e.on||{}).forEach((function(n){n.indexOf("-")>0&&(n=ie(n));var r="on".concat(M(n));Array.isArray(t[r])?t[r]=[].concat(V(t[r]),[e.on[n]]):t[r]?t[r]=[t[r],e.on[n]]:t[r]=e.on[n]})),t.key=e.key,t.ref=e.ref,t.class=e.class,t.id=e.id,t.style=e.style,t.slot&&delete t.slot,t}function xe(e,t){return Object.setPrototypeOf(e,t),e}var Oe=function(e,t){return"string"==typeof e?String(t):"number"==typeof e?Number(t):t},Ce={"==":function(e,t){return JSON.stringify(e)===JSON.stringify(Oe(e,t))},"!=":function(e,t){return!Ce["=="](e,t)},">":function(e,t){return e>t},">=":function(e,t){return e>=t},"<":function(e,t){return e<t},"<=":function(e,t){return e<=t},on:function(e,t){return e&&e.indexOf&&e.indexOf(Oe(e[0],t))>-1},notOn:function(e,t){return!Ce.on(e,t)},in:function(e,t){return t&&t.indexOf&&t.indexOf(e)>-1},notIn:function(e,t){return!Ce.in(e,t)},between:function(e,t){return e>t[0]&&e<t[1]},notBetween:function(e,t){return e<t[0]||e>t[1]},empty:function(e){return B.empty(e)},notEmpty:function(e){return!B.empty(e)},pattern:function(e,t){return new RegExp(t,"g").test(e)}};function Se(e,t){return(Array.isArray(t)?t:(t||"").split(".")).forEach((function(t){null!=e&&(e=e[t])})),e}function je(e){var t=e.split("."),n=[],r="";return t.forEach((function(e,t){0===t?r=e:r+="."+e,n.push(r)})),n.join(" && ")}function Fe(e){for(var t=[],n="",r=0,i=0;i<e.length;i++){var a=e[i];"["===a?(0===r&&n&&(t.push({type:"key",value:n}),n=""),r++,n+=a):"]"===a?(n+=a,0===--r&&(t.push({type:"bracket",value:Fe(n.slice(1,-1))}),n="")):"."===a&&0===r?n&&(t.push({type:"key",value:n}),n=""):n+=a}return n&&t.push({type:"key",value:n}),t.map((function(e){return"key"===e.type?{key:e.value}:{children:e.value}}))}var Ee=function(e,t){if(e&&e!==t)return e.props.formCreateInject?e.props.formCreateInject:e.parent?Ee(e.parent,t):void 0};function we(e,v,m){return t({name:"FormCreate"+(e.isMobile?"Mobile":""),components:v,directives:m,props:{rule:{type:Array,required:!0,default:function(){return[]}},option:{type:Object,default:function(){return{}}},extendOption:Boolean,driver:[String,Object],modelValue:Object,disabled:{type:Boolean,default:void 0},preview:{type:Boolean,default:void 0},index:[String,Number],api:Object,locale:[String,Object],t:Function,name:String,subForm:{type:Boolean,default:!0},inFor:Boolean},emits:["update:api","update:modelValue","mounted","submit","reset","change","emit-event","control","remove-rule","remove-field","sync","reload","repeat-field","update","validate-field-fail","validate-fail","created"],render:function(){return this.fc.render()},setup:function(t){var v=n();r("parentFC",v);var m=i("parentFC",null),g=m;if(m)for(;g.setupState.parent;)g=g.setupState.parent;else g=v;var y=a(t),b=y.rule,_=y.modelValue,$=y.subForm,x=y.inFor,O=o({ctxInject:{},destroyed:!1,isShow:!0,unique:1,renderRule:V(b.value||[]),updateValue:JSON.stringify(_.value||{})}),C=new e(v),j=C.api(),F=x.value,E=null;u((function(){c((function(){var e="",n=t.option&&t.option.globalClass||{};Object.keys(n).forEach((function(t){var r="";n[t].style&&Object.keys(n[t].style).forEach((function(e){r+=I(e)+":"+n[t].style[e]+";"})),n[t].content&&(r+=n[t].content+";"),r&&(e+=".".concat(t,"{").concat(r,"}"))})),t.option&&t.option.style&&(e+=t.option.style),E||((E=document.createElement("style")).type="text/css",document.head.appendChild(E)),E.innerHTML=e||""}))}));var w=T((function(){C.bus.$emit("$loadData.$topForm")}),100),D=T((function(){C.bus.$emit("$loadData.$scopeForm")}),100),k=T((function(){C.bus.$emit("$loadData.$form")}),100),A=function(e){C.bus.$emit("change-$form."+e)};return l((function(){m&&(j.top.bus.$on("$loadData.$form",w),j.top.bus.$on("change",A)),j!==j.scope&&j.scope.bus.$on("$loadData.$scopeForm",D),C.mounted()})),f((function(){m&&(j.top.bus.$off("$loadData.$form",w),j.top.bus.$off("change",A)),j!==j.scope&&j.scope.bus.$off("$loadData.$scopeForm",D),function(){var e=Ee(v,m);if(e)if(F){var t=N(e.getSubForm()),n=t.indexOf(j);n>-1&&t.splice(n,1)}else e.subForm()}(),O.destroyed=!0,C.unmount(),E&&(E.parentNode||E.parentElement)&&document.head.removeChild(E)})),s((function(){C.updated()})),function(){if(m){var e,t=Ee(v,m);if(t)F?(e=N(t.getSubForm())).push(j):e=j,t.subForm(e)}}(),d((function(){return t.option}),(function(){C.initOptions(),j.refresh()}),{deep:!0}),d((function(){return V(b.value)}),(function(e){C.$handle.isBreakWatch()||e.length===O.renderRule.length&&e.every((function(e){return O.renderRule.indexOf(e)>-1}))||(C.$handle.updateAppendData(),C.$handle.reloadRule(b.value),v.setupState.renderRule())})),d((function(){return[t.disabled,t.preview]}),(function(){j.refresh()})),d(_,(function(e){ce(e||{})!==O.updateValue&&(j.config.forceCoverValue?j.coverValue(e||{}):j.setValue(e||{}))}),{deep:!0,flush:"post"}),d((function(){return t.index}),(function(){j.coverValue({}),C.$handle.updateAppendData(),p((function(){p((function(){j.clearValidateState()}))}))}),{flush:"sync"}),S(S({fc:h(C),parent:m?h(m):m,top:h(g),fapi:h(j)},a(O)),{},{getGroupInject:function(){return Ee(v,m)},refresh:function(){++O.unique},renderRule:function(){O.renderRule=V(b.value||[])},updateValue:function(e){if(!O.destroyed){var t=ce(e);O.updateValue!==t&&(O.updateValue=t,v.emit("update:modelValue",e),p((function(){k(),m?$.value||D():(w(),D())})))}}})},created:function(){var e=n();e.emit("update:api",e.setupState.fapi),e.setupState.fc.init()}})}var De=Object.assign||function(e){for(var t,n=1;n<arguments.length;n++)for(var r in t=arguments[n])Object.prototype.hasOwnProperty.call(t,r)&&q(e,r,t[r]);return e};function ke(){return De.apply(this,arguments)}function Ae(e){return"object"!==j(e)||null===e?e:e instanceof Array?V(e):S({},e)}function Re(e,t){return function(n,r,i){var a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{},o=new Ve(e,n,r,i,a);return t&&(B.Function(t)?t(o):o.props(t)),o}}function Ve(e,t,n,r,i){this._data=ke({props:{},on:{},options:[],children:[],hidden:!1,display:!0,value:void 0},{type:e,title:t,field:n,value:r,props:i||{}}),this.event=this.on}function Pe(e){e.forEach((function(e){Ve.prototype[e]=function(t){return ve(this._data,E({},e,arguments.length<2?t:E({},t,arguments[1]))),this}}))}ke(Ve.prototype,{getRule:function(){return this._data},setProp:function(e,t){return q(this._data,e,t),this},modelField:function(e){return this._data.modelField=e,this},_clone:function(){var e=new this.constructor;return e._data=pe(this._data),e}}),Pe(te());var Le=Re("");function Ne(e,t,n){var r=Le("",t);return r._data.type=e,r._data.title=n,r}function Te(){return{create:Ne,factory:Re}}function Ie(e){var t=e.responseText||e.response;if(!t)return t;try{return JSON.parse(t)}catch(e){return t}}function Me(e){if("undefined"!=typeof XMLHttpRequest){var t,n=new XMLHttpRequest,r=e.action||"";if(n.upload&&e.onProgress&&n.upload.addEventListener("progress",(function(t){t.percent=t.total>0?t.loaded/t.total*100:0,e.onProgress(t)})),e.query){var i=new URLSearchParams(e.query).toString();i&&(r.includes("?")?r+="&".concat(i):r+="?".concat(i))}n.onerror=function(t){e.onError(t)},n.onload=function(){if(n.status<200||n.status>=300)return e.onError(function(e,t,n){var r="fail to ".concat(e," ").concat(n.status,"'"),i=new Error(r);return i.status=n.status,i.url=e,i}(r,0,n),Ie(n));e.onSuccess(Ie(n))},n.open(e.method||"get",r,!0),(e.data||e.file)&&(e.file||"json"!==(e.dataType||"").toLowerCase()?(t=new FormData,Object.keys(e.data||{}).map((function(n){t.append(n,e.data[n])}))):(t=JSON.stringify(e.data||{}),n.setRequestHeader("content-type","application/json"))),e.file&&t.append(e.filename,e.file,e.file.name),e.withCredentials&&"withCredentials"in n&&(n.withCredentials=!0);var a=e.headers||{};Object.keys(a).forEach((function(e){null!=a[e]&&n.setRequestHeader(e,a[e])})),n.send(t)}}function qe(e,t,n){return new Promise((function(r,i){(t||Me)(S(S({},e),{},{onSuccess:function(t){var i=function(e){return e},a=fe(e.parse);B.Function(a)?i=a:a&&B.String(a)&&(i=function(e){return Se(e,a)}),r(i(t,void 0,n))},onError:function(e){i(e)}}))}))}function Ue(e){return J(e)}var Be=0;function Ge(){var e=370+ ++Be;return"F"+Math.random().toString(36).substr(3,3)+Number("".concat(Date.now())).toString(36)+e.toString(36)+"c"}function He(e,t,n){var r,i=e;return(t||"").split(".").forEach((function(e){r&&(i[r]&&"object"==j(i[r])||(i[r]={}),i=i[r]),r=e})),i[r]=n,i}var Je=1;function We(e){ke(this,{$handle:e,fc:e.fc,vm:e.vm,$manager:e.$manager,vNode:new e.fc.CreateNode(e.vm),force:!1,tmpInput:null,id:Je++}),ge(this,{options:function(){return e.options},sort:function(){return e.sort}}),this.initCache(),this.initRender()}!function(e){ke(e.prototype,{initCache:function(){this.clearCacheAll()},clearCache:function(e){e.rule.cache||(this.cache[e.id]?((!0===this.cache[e.id].use||this.cache[e.id].parent)&&this.$handle.refresh(),this.cache[e.id].parent&&this.clearCache(this.cache[e.id].parent),this.cache[e.id]=null):e.parent&&this.clearCache(e.parent))},clearCacheAll:function(){this.cache={}},setCache:function(e,t,n){this.cache[e.id]={vnode:t,use:!1,parent:n,slot:e.rule.slot}},getCache:function(e){var t=this.cache[e.id];if(t)return t.use=!0,t.vnode}})}(We),function(e){ke(e.prototype,{initRender:function(){this.cacheConfig={}},getTypeSlot:function(e){return function t(n){if(n){var r=void 0;return e.rule.field&&(r=n.slots["field-"+I(e.rule.field)]||n.slots["field-"+e.rule.field]),r||(r=n.slots["type-"+I(e.type)]||n.slots["type-"+e.type]),r||t(n.setupState.parent)}}(this.vm)},render:function(){var e=this;if(this.vm.setupState.isShow){this.$manager.beforeRender();var t=_e();return this.sort.forEach((function(n){e.renderSlot(t,e.$handle.ctxs[n])})),this.$manager.render(t)}},renderSlot:function(e,t,n){if(this.isFragment(t)){t.initProp(),this.mergeGlobal(t),t.initNone();var r=this.renderChildren(t.loadChildrenPending(),t),i=r.default;i&&e.setSlot(t.rule.slot,(function(){return i()})),delete r.default,e.mergeBag(r)}else e.setSlot(t.rule.slot,this.renderCtx(t,n))},mergeGlobal:function(e){var t=this;this.$handle.options.global&&(this.cacheConfig[e.trueType]||(this.cacheConfig[e.trueType]=v((function(){var n=t.$handle.options.global;return ve({},[n["*"]||n.default||{},n[e.originType]||n[e.type]||n[e.type]||{}])}))),e.prop=ve({},[this.cacheConfig[e.trueType].value,e.prop]))},setOptions:function(e){var t=e.loadPending({key:"options",origin:e.prop.options,def:[]});e.prop.options=t,e.prop.optionsTo&&t&&He(e.prop,e.prop.optionsTo,t)},deepSet:function(e){var t=e.rule.deep;t&&Object.keys(t).sort((function(e,t){return e.length<t.length?-1:1})).forEach((function(n){He(e.prop,n,t[n])}))},parseSide:function(e,t){return B.Object(e)?ve({props:{formCreateInject:t.prop.props.formCreateInject}},e):e},renderSides:function(e,t,n){var r=t[n?"rule":"prop"];return[this.renderRule(this.parseSide(r.prefix,t)),e,this.renderRule(this.parseSide(r.suffix,t))]},renderId:function(e,t){var n=this,r=this.$handle["field"===t?"fieldCtx":"nameCtx"][e];return r?r.map((function(e){return n.renderCtx(e,e.parent)})):void 0},renderCtx:function(e,t){var n=this;try{if("hidden"===e.type)return;var r=e.rule;if(this.force||!this.cache[e.id]||this.cache[e.id].slot!==r.slot){var i;e.initProp(),this.mergeGlobal(e),e.initNone(),this.$manager.tidyRule(e),this.deepSet(e),this.setOptions(e),this.ctxProp(e);var a=e.prop;a.preview=!!(null!=a.preview?a.preview:this.$handle.preview),a.props.formCreateInject=this.injectProp(e);var o=!1!==a.cache,u=a.preview;if(a.hidden)return void this.setCache(e,void 0,t);i=function(){for(var i=arguments.length,c=new Array(i),l=0;l<i;l++)c[l]=arguments[l];var f={rule:r,prop:a,preview:u,api:n.$handle.api,model:a.model||{},slotValue:c};c.length&&r.slotUpdate&&be((function(){return r.slotUpdate(f)}));var s={},d=e.loadChildrenPending();e.parser.renderChildren?s=e.parser.renderChildren(d,e):!1!==e.parser.loadChildren&&(s=n.renderChildren(d,e)),Object.keys(a.renderSlots||{}).forEach((function(t){s[t]=function(){for(var r=arguments.length,i=new Array(r),o=0;o<r;o++)i[o]=arguments[o];if(B.Function(a.renderSlots[t]))return be((function(){var e;return(e=a.renderSlots)[t].apply(e,i)}));var u=n.parseSide(a.renderSlots[t],e);return n.renderRule(u)}}));var p,h=n.getTypeSlot(e);return h?(f.children=s,p=h(f)):p=u?e.parser.preview(Ae(s),e):e.parser.render(Ae(s),e),p=n.renderSides(p,e),!e.input&&B.Undef(a.native)||!0===a.native||(n.fc.targetFormDriver("updateWrap",e),p=n.$manager.makeWrap(e,p)),e.none&&(p=Array.isArray(p)?p.map((function(e){return e&&e.__v_isVNode?n.none(e):e})):n.none(p)),o&&n.setCache(e,(function(){return n.stable(p)}),t),p},this.setCache(e,i,t)}return function(){var t=n.getCache(e);if(t)return t.apply(void 0,arguments);if(!n.cache[e.id]){var r=n.renderCtx(e,e.parent);return r?r():void 0}}}catch(e){return void console.error(e)}},none:function(e){if(e)return e.props.class=this.mergeClass(e.props.class,"fc-none"),e},mergeClass:function(e,t){return Array.isArray(e)?(e.push(t),e):e?[e,t]:t},stable:function(e){var t=this;return(Array.isArray(e)?e:[e]).forEach((function(e){e&&e.__v_isVNode&&e.children&&"object"===j(e.children)&&(e.children.$stable=!0,t.stable(e.children))})),e},getModelField:function(e){return e.prop.modelField||e.parser.modelField||this.fc.modelFields[this.vNode.aliasMap[e.type]]||this.fc.modelFields[e.type]||this.fc.modelFields[e.originType]||"modelValue"},isFragment:function(e){return"fragment"===e.type||"template"===e.type},injectProp:function(e){var t=this,n=this.vm.setupState;n.ctxInject[e.id]||(n.ctxInject[e.id]={api:this.$handle.api,form:this.fc.create,subForm:function(n){t.$handle.addSubForm(e,n)},getSubForm:function(){return t.$handle.subForm[e.id]},slots:function(){return t.vm.setupState.top.slots},getWrap:function(){return t.vm.refs[e.wrapRef]},options:[],children:[],preview:!1,id:e.id,field:e.field,rule:e.rule,input:e.input,t:function(){var e;return(e=t.$handle.api).t.apply(e,arguments)},updateValue:function(n){t.$handle.onUpdateValue(e,n)}});var r=n.ctxInject[e.id];return ke(r,{preview:e.prop.preview,options:e.prop.options,children:e.loadChildrenPending()}),r},ctxProp:function(e){var t=this,n=e.ref,r=e.key,i=e.rule;this.$manager.mergeProp(e),e.parser.mergeProp(e);var a=[{ref:n,key:i.key||"".concat(r,"fc"),slot:void 0,on:{vnodeMounted:function(n){n.el.__rule__=e.rule,t.onMounted(e,n.el)},"fc.updateValue":function(n){t.$handle.onUpdateValue(e,n)},"fc.el":function(t){e.exportEl=t,t&&((t.$el||t).__rule__=e.rule)}}}];if(e.input){var o=this.tmpInput;!0===this.vm.props.disabled&&(e.prop.props.disabled=!0);var u=this.getModelField(e),c={callback:function(n){o&&o(e.field,n,e.rule),t.onInput(e,n)},modelField:u,value:this.$handle.getFormData(e)};a.push({on:S(E({},"update:".concat(u),c.callback),e.prop.modelEmit?E({},e.prop.modelEmit,(function(){return t.onEmitInput(e)})):{}),props:E({},u,c.value)}),e.prop.model=c}return X(a,e.prop),e.prop},onMounted:function(e,t){e.el=this.vm.refs[e.ref]||t,e.parser.mounted(e),this.$handle.effect(e,"mounted"),this.$handle.targetHook(e,"mounted")},onInput:function(e,t){e.prop.modelEmit?this.$handle.onBaseInput(e,t):this.$handle.onInput(e,t)},onEmitInput:function(e){this.$handle.setValue(e,e.parser.toValue(e.modelValue,e),e.modelValue)},renderChildren:function(e,t){var n=this;if(!B.trueArray(e))return{};var r=_e();return e.map((function(i){if(i)return B.String(i)?r.setSlot(null,i):i.__fc__?n.renderSlot(r,i.__fc__,t):void(i.type&&p((function(){n.$handle.loadChildren(e,t),n.$handle.refresh()})))})),r.getSlots()},defaultRender:function(e,t){var n=e.prop;return n.component?"string"==typeof n.component?this.vNode.make(n.component,n,t):this.vNode.makeComponent(n.component,n,t):this.vNode[e.type]?this.vNode[e.type](n,t):this.vNode[e.originType]?this.vNode[e.originType](n,t):this.vNode.make(ae(n.type),n,t)},createChildrenVnodes:function(e,t,n){this.force=!1!==n,this.tmpInput=t;var r=this.renderChildren(e.rule.children,e);return this.force=!1,this.tmpInput=null,r},createRuleVnode:function(e,t,n){this.force=!1!==n,this.tmpInput=t;var r=_e();return this.renderSlot(r,e,e.parent),this.force=!1,this.tmpInput=null,r.getSlots()},renderRule:function(e,t,n){var r=this;if(e){if(B.String(e))return e;var i;if(n)i=e.type;else if(i=e.is,e.type){i=ie(e.type);var a=this.vNode.aliasMap[i];a&&(i=ie(a))}if(i){var o=_e();B.trueArray(e.children)&&e.children.forEach((function(e){e&&o.setSlot(null==e?void 0:e.slot,(function(){return r.renderRule(e)}))}));var u=S({},e);return delete u.type,delete u.is,this.vNode.make(i,u,o.mergeBag(t).getSlots())}}}})}(We);var ze=["hook:updated","hook:mounted"];function Ke(e,t,n){var r,i=Ge(),a=!!t.field;ke(this,{id:i,ref:i,wrapRef:i+"fi",rule:t,origin:t.__origin__||t,name:t.name,pending:{},none:!1,watch:[],linkOn:[],root:[],ctrlRule:[],children:[],parent:null,group:t.subRule?this:null,cacheConfig:null,prop:S({},t),computed:{},payload:{},refRule:{},input:a,el:void 0,exportEl:void 0,defaultValue:a?J(n):void 0,field:t.field||void 0}),this.updateKey(),r=this,Object.defineProperties(r.origin,{__fc__:de(h(r),!0)}),r.rule!==r.origin&&Object.defineProperties(r.rule,{__fc__:de(h(r),!0)}),this.update(e,!0)}function Xe(e,t){for(var n=0;n<e.ctrlRule.length;n++){var r=e.ctrlRule[n];if(r.children===t)return r}}function Ze(e){return!!e.rule.__ctrl}function Qe(e,t){return"function"==typeof t?""+t:t}ke(Ke.prototype,{getParentGroup:function(){for(var e=this.parent;e;){if(e.group)return e;e=e.parent}},loadChildrenPending:function(){var e=this,t=this.rule.children||[];return Array.isArray(t)?t:this.loadPending({key:"children",origin:t,def:[],onLoad:function(t){e.$handle&&e.$handle.loadChildren(t,e)},onUpdate:function(t,n){e.$handle&&(t===n?e.$handle.loadChildren(t,e):e.$handle.updateChildren(e,t,n))},onReload:function(t){e.$handle?e.$handle.updateChildren(e,[],t):delete e.pending.children}})},loadPending:function(e){var t=this,n=e.key,r=e.origin,i=e.def,a=e.onLoad,o=e.onReload,u=e.onUpdate;if(this.pending[n]&&this.pending[n].origin===r)return this.getPending(n,i);delete this.pending[n];var c=r;if(B.Function(r)){var l=be((function(){return r({rule:t.rule,api:t.$api,update:function(e){var a=e||i,o=t.getPending(n,i);t.setPending(n,r,a),u&&u(a,o)},reload:function(){var e=t.getPending(n,i);delete t.pending[n],o&&o(e),t.$api&&t.$api.sync(t.rule)}})}));l&&B.Function(l.then)?(l.then((function(e){var o=e||i;t.setPending(n,r,o),a&&a(o),t.$api&&t.$api.sync(t.rule)})).catch((function(e){console.error(e)})),c=i,this.setPending(n,r,c)):(c=l||i,this.setPending(n,r,c),a&&a(c))}return c},getPending:function(e,t){return this.pending[e]&&this.pending[e].value||t},setPending:function(e,t,n){this.pending[e]={origin:t,value:o(n)}},effectData:function(e){return this.payload[e]||(this.payload[e]={}),this.payload[e]},clearEffectData:function(e){void 0===e?this.payload={}:delete this.payload[e]},updateKey:function(e){this.key=Ge(),e&&this.parent&&this.parent.updateKey(e)},updateType:function(){this.originType=this.rule.type,this.type=ie(this.rule.type),this.trueType=this.$handle.getType(this.originType)},setParser:function(e){this.parser=e,e.init(this)},initProp:function(){var e,t,n=this,r=S({},this.rule);delete r.children,delete r.validate,this.prop=ve({},[r].concat(V(Object.keys(this.payload).map((function(e){return n.payload[e]}))),[this.computed])),this.prop.validate=[].concat(V((null===(e=this.refRule)||void 0===e||null===(t=e.__$validate)||void 0===t?void 0:t.value)||[]),V(this.prop.validate||[]))},initNone:function(){this.none=!(B.Undef(this.prop.display)||this.prop.display)},hasHidden:function(){return!!this.rule.hidden||!!this.parent&&this.parent.hasHidden()},injectValidate:function(){return this.prop.validate},check:function(e){return this.vm===e.vm},unwatch:function(){this.watch.forEach((function(e){return e()})),this.watch=[],this.refRule={}},unlink:function(){this.linkOn.forEach((function(e){return e()})),this.linkOn=[]},link:function(){this.unlink(),this.$handle.appendLink(this)},watchTo:function(){this.$handle.watchCtx(this)},delete:function(){this.unwatch(),this.unlink(),this.rmCtrl(),this.parent&&this.parent.children.splice(this.parent.children.indexOf(this)>>>0,1),ke(this,{deleted:!0,computed:{},parent:null,children:[],cacheConfig:null,none:!1})},rmCtrl:function(){this.ctrlRule.forEach((function(e){return e.__fc__&&e.__fc__.rm()})),this.ctrlRule=[]},rm:function(){var e=this,t=function(){var t=e.root.indexOf(e.origin);t>-1&&(e.root.splice(t,1),e.$handle&&e.$handle.refresh())};this.deleted?t():this.$handle.noWatch((function(){e.$handle.deferSyncValue((function(){e.rmCtrl(),t(),e.$handle.rmCtx(e),ke(e,{root:[]})}),e.input)}))},update:function(e,t){ke(this,{deleted:!1,$handle:e,$render:e.$render,$api:e.api,vm:e.vm,vNode:e.$render.vNode,updated:!1,cacheValue:this.rule.value}),!t&&this.unwatch(),this.watchTo(),this.link(),this.updateType()}});var Ye={init:function(e){},toFormValue:function(e,t){return e},toValue:function(e,t){return e},mounted:function(e){},render:function(e,t){return t.$handle.fc.renderDriver&&t.$handle.fc.renderDriver.defaultRender?t.$handle.fc.renderDriver.defaultRender(t,e):t.$render.defaultRender(t,e)},preview:function(e,t){return t.$handle.fc.renderDriver&&t.$handle.fc.renderDriver.defaultPreview?t.$handle.fc.renderDriver.defaultPreview(t,e):this.render(e,t)},mergeProp:function(e){}},et=["field","value","vm","template","name","config","control","inject","sync","payload","optionsTo","update","slotUpdate","computed","component","cache"],tt=Symbol("oldValue");function nt(e){var t=this;ge(this,{options:function(){return e.options.value||{}},bus:function(){return e.bus},preview:function(){return null!=e.vm.props.preview?e.vm.props.preview:e.vm.setupState.parent&&null!=e.vm.setupState.parent.props.preview?e.vm.setupState.parent.props.preview:e.options.value.preview||!1}}),ke(this,{fc:e,vm:e.vm,watching:!1,loading:!1,reloading:!1,noWatchFn:null,deferSyncFn:null,isMounted:!1,formData:o({}),subRuleData:o({}),subForm:{},form:o({}),appendData:{},ignoreFields:[],providers:{},cycleLoad:null,loadedId:1,nextTick:null,changeStatus:!1,pageEnd:!0,nextReload:function(){t.lifecycle("reload")}}),this.initData(e.rules),this.$manager=new e.manager(this),this.$render=new We(this),this.api=e.extendApiFn.reduce((function(e,n){var r=be((function(){return n(e,t)}));return r&&r!==e&&ke(e,r),e}),function(e){function t(t){return B.Undef(t)?t=e.fields():Array.isArray(t)||(t=[t]),t}function n(t,n,r){B.Undef(t)?t=Object.keys(S(S({},e.fieldCtx),e.nameCtx)):Array.isArray(t)||(t=[t]),t.forEach((function(t){var i=e.fieldCtx[t]||e.nameCtx[t];i&&i.forEach((function(t){q(t.rule,n,r),e.$render.clearCache(t)}))}))}function r(){var t=e.subForm;return Object.keys(t).reduce((function(e,n){var r=t[n];return r?(Array.isArray(r)?e.push.apply(e,V(r)):e.push(r),e):e}),[])}var i={get isScope(){return!1===e.vm.props.subForm},get isPreview(){return e.preview},get config(){return e.options},set config(t){e.fc.options.value=t},get options(){return e.options},set options(t){e.fc.options.value=t},get form(){return e.form},get rule(){return e.rules},get parent(){return e.vm.setupState.parent&&e.vm.setupState.parent.setupState.fapi},get top(){return i.parent?i.parent.top:i},get scope(){for(var t=e.vm;t&&t.setupState.fapi;){if(!t.props.subForm)return t.setupState.fapi;t=t.setupState.parent}return i.top},get children(){return r()},get siblings(){var t=e.vm.setupState.getGroupInject();if(t){var n=t.getSubForm();if(Array.isArray(n))return V(n)}},get index(){var e=i.siblings;if(e){var t=e.indexOf(i);return t>-1?t:void 0}},get formulas(){return S({},e.fc.formulas)},formData:function(n){if(null==n||"boolean"==typeof n){var r={};return Object.keys(e.form).forEach((function(t){!0!==n&&-1!==e.ignoreFields.indexOf(t)||(r[t]=Ue(e.form[t]))})),r}return t(n).reduce((function(e,t){return e[t]=i.getValue(t),e}),{})},getValue:function(t){var n=e.getFieldCtx(t);return n?Ue(n.rule.value):!1!==e.options.appendValue&&G(e.appendData,t)?Ue(e.appendData[t]):void 0},coverValue:function(t){var n=S({},t||{});e.deferSyncValue((function(){e.appendData={},i.fields().forEach((function(r){var i=e.fieldCtx[r];if(i){var a=G(t,r);i.forEach((function(e){e.rule.value=a?t[r]:void 0})),delete n[r]}})),ke(e.appendData,n)}),!0)},setValue:function(t){var n=t;arguments.length>=2&&(n=E({},t,arguments[1])),e.deferSyncValue((function(){Object.keys(n).forEach((function(t){var r=e.fieldCtx[t];if(!r)return e.appendData[t]=n[t];r.forEach((function(e){e.rule.value=n[t]}))}))}),!0)},removeField:function(t){var n=e.getCtx(t);return e.deferSyncValue((function(){e.getCtxs(t).forEach((function(e){e.rm()}))}),!0),n?n.origin:void 0},removeRule:function(e){var t=e&&ye(e);if(t)return t.rm(),t.origin},fields:function(){return e.fields()},append:function(t,n,r){var i,a=e.sort.length-1,o=e.getCtx(n);if(o)if(r){if(i=o.getPending("children",o.rule.children),!Array.isArray(i))return;a=o.rule.children.length-1}else a=o.root.indexOf(o.origin),i=o.root;else i=e.rules;i.splice(a+1,0,t)},prepend:function(t,n,r){var i,a=0,o=e.getCtx(n);if(o)if(r){if(i=o.getPending("children",o.rule.children),!Array.isArray(i))return}else a=o.root.indexOf(o.origin),i=o.root;else i=e.rules;i.splice(a,0,t)},hidden:function(t,r){n(r,"hidden",!!t),e.refresh()},hiddenStatus:function(t){var n=e.getCtx(t);if(n)return!!n.rule.hidden},display:function(t,r){n(r,"display",!!t),e.refresh()},displayStatus:function(t){var n=e.getCtx(t);if(n)return!!n.rule.display},disabled:function(n,r){t(r).forEach((function(t){e.getCtxs(t).forEach((function(e){q(e.rule.props,"disabled",!!n)}))})),e.refresh()},all:function(t){return Object.keys(e.ctxs).map((function(n){var r=e.ctxs[n];return t?r.origin:r.rule}))},model:function(t){return e.fields().reduce((function(n,r){var i=e.fieldCtx[r][0];return n[r]=t?i.origin:i.rule,n}),{})},component:function(t){return Object.keys(e.nameCtx).reduce((function(n,r){var i=e.nameCtx[r].map((function(e){return t?e.origin:e.rule}));return n[r]=1===i.length?i[0]:i,n}),{})},bind:function(){return i.form},reload:function(t){e.reloadRule(t)},updateOptions:function(t){e.fc.updateOptions(t),i.refresh()},onSubmit:function(e){i.updateOptions({onSubmit:e})},sync:function(t){if(Array.isArray(t))t.forEach((function(e){return i.sync(e)}));else{var n=B.Object(t)?ye(t):e.getCtxs(t);n&&((n=Array.isArray(n)?n:[n]).forEach((function(t){if(!t.deleted){var n=e.subForm[t.id];n&&(Array.isArray(n)?n.forEach((function(e){e.refresh()})):n&&n.refresh()),e.$render.clearCache(t)}})),e.refresh())}},refresh:function(){r().forEach((function(e){e.refresh()})),e.$render.clearCacheAll(),e.refresh()},refreshOptions:function(){e.$manager.updateOptions(e.options),i.refresh()},hideForm:function(t){e.vm.setupState.isShow=!t},changeStatus:function(){return e.changeStatus},clearChangeStatus:function(){e.changeStatus=!1},updateRule:function(t,n){e.getCtxs(t).forEach((function(e){ke(e.rule,n)}))},updateRules:function(e){Object.keys(e).forEach((function(t){i.updateRule(t,e[t])}))},mergeRule:function(t,n){e.getCtxs(t).forEach((function(e){ve(e.rule,n)}))},mergeRules:function(e){Object.keys(e).forEach((function(t){i.mergeRule(t,e[t])}))},getRule:function(t,n){var r=e.getCtx(t);if(r)return n?r.origin:r.rule},getRenderRule:function(t){var n=e.getCtx(t);if(n)return n.prop},getRefRule:function(t){var n=e.getCtxs(t);if(n){var r=n.map((function(e){return e.rule}));return 1===r.length?r[0]:r}},setEffect:function(t,n,r){var i=e.getCtx(t);i&&n&&("$"===n[0]&&(n=n.substr(1)),G(i.rule,"$"+n)&&q(i.rule,"$"+n,r),G(i.rule,"effect")||(i.rule.effect={}),q(i.rule.effect,n,r))},clearEffectData:function(t,n){var r=e.getCtx(t);r&&(n&&"$"===n[0]&&(n=n.substr(1)),r.clearEffectData(n),i.sync(t))},updateValidate:function(e,t,r){r?i.mergeRule(e,{validate:t}):n(e,"validate",t)},updateValidates:function(e,t){Object.keys(e).forEach((function(n){i.updateValidate(n,e[n],t)}))},refreshValidate:function(){i.refresh()},resetFields:function(n){t(n).forEach((function(t){e.getCtxs(t).forEach((function(t){e.$render.clearCache(t),t.rule.value=Ue(t.defaultValue)}))})),p((function(){p((function(){p((function(){i.clearValidateState(n)}))}))})),null==n&&(B.Function(e.options.onReset)&&be((function(){return e.options.onReset(i)})),e.vm.emit("reset",i))},method:function(e,t){var n=i.el(e);if(!n||!n[t])throw new Error(ne("err","".concat(t," 方法不存在")));return function(){return n[t].apply(n,arguments)}},exec:function(e,t){for(var n=arguments.length,r=new Array(n>2?n-2:0),a=2;a<n;a++)r[a-2]=arguments[a];return be((function(){return i.method(e,t).apply(void 0,r)}))},toJson:function(e){return ce(i.rule,e)},trigger:function(e,t){for(var n=i.el(e),r=arguments.length,a=new Array(r>2?r-2:0),o=2;o<r;o++)a[o-2]=arguments[o];n&&n.$emit.apply(n,[t].concat(a))},el:function(t){var n=e.getCtx(t);if(n)return n.el||e.vm.refs[n.ref]},closeModal:function(t){e.bus.$emit("fc:closeModal:"+t)},getSubForm:function(t){var n=e.getCtx(t);return n?e.subForm[n.id]:void 0},getChildrenRuleList:function(t){var n="object"===j(t),r=n?ye(t):e.getCtx(t),a=r?r.rule:n?t:i.getRule(t);if(!a)return[];var o,u=[];return(o=r?r.loadChildrenPending():a.children)&&o.forEach((function(e){"object"===j(e)&&(e.field&&u.push(e),u.push.apply(u,V(i.getChildrenRuleList(e))))})),u},getParentRule:function(t){return("object"===j(t)?ye(t):e.getCtx(t)).parent.rule},getParentSubRule:function(t){var n="object"===j(t)?ye(t):e.getCtx(t);if(n){var r=n.getParentGroup();if(r)return r.rule}},getChildrenFormData:function(e,t){return i.getChildrenRuleList(e).reduce((function(e,n){return!0===n.ignore&&!0!==t||(e[n.field]=Ue(n.value)),e}),{})},setChildrenFormData:function(t,n,r){var a=i.getChildrenRuleList(t);e.deferSyncValue((function(){a.forEach((function(e){G(n,e.field)?e.value=n[e.field]:r&&(e.value=void 0)}))}))},getGlobalEvent:function(e){var t=i.options.globalEvent[e];if(t)return"object"===j(t)&&(t=t.handle),fe(t)},getGlobalData:function(t){return new Promise((function(n,r){var a=i.options.globalData[t];a?"fetch"===a.type?i.fetch(a).then((function(e){n(e)})).catch(r):n(a.data):n(e.fc.loadData[t])}))},setGlobalData:function(e,t){i.setData("$globalData."+e,t)},setGlobalVar:function(e,t){i.setData("$var."+e,t)},renderRule:function(t,n,r){var i="object"===j(t)?ye(t):e.getCtx(t);return i?e.$render.createRuleVnode(i,n,r):void 0},renderChildren:function(t,n,r){var i="object"===j(t)?ye(t):e.getCtx(t);return i?e.$render.createChildrenVnodes(i,n,r):void 0},nextTick:function(t){e.bus.$once("next-tick",t),e.refresh()},nextRefresh:function(t){e.nextRefresh(),t&&be(t)},deferSyncValue:function(t,n){e.deferSyncValue(t,n)},emit:function(t){for(var n,r=arguments.length,i=new Array(r>1?r-1:0),a=1;a<r;a++)i[a-1]=arguments[a];(n=e.vm).emit.apply(n,[t].concat(i))},bus:e.bus,fetch:function(t){return new Promise((function(n,r){t=J(t),t=e.loadFetchVar(t),e.beforeFetch(t).then((function(){return qe(t,e.fc.create.fetch,i).then((function(e){be((function(){return t.onSuccess&&t.onSuccess(e)})),n(e)})).catch((function(e){be((function(){return t.onError&&t.onError(e)})),r(e)}))})).catch((function(e){}))}))},watchFetch:function(t,n,r,a){return e.fc.watchLoadData((function(o,u){var c=J(t);c=e.loadFetchVar(c,o),a&&!1===a(c,u)||e.beforeFetch(c).then((function(){return qe(c,e.fc.create.fetch,i).then((function(e){be((function(){return c.onSuccess&&c.onSuccess(e)})),n&&n(e,u)})).catch((function(e){be((function(){return c.onError&&c.onError(e)})),r&&r(e)}))})).catch((function(e){}))}),null==t.wait?1e3:t.wait)},getData:function(t,n){return e.fc.get?e.fc.get(t,n):e.fc.getLoadData(t,n)},watchData:function(t){return e.fc.watchLoadData((function(e,n){be((function(){return t(e,n)}))}))},setData:function(t,n,r){return e.fc.setData(t,n,r)},refreshData:function(t){return e.fc.refreshData(t)},t:function(t,n){return e.fc.t(t,n)},getLocale:function(){return e.fc.getLocale()},helper:{tidyFields:t,props:n}};return["on","once","off"].forEach((function(t){i[t]=function(){var n;(n=e.bus)["$".concat(t)].apply(n,arguments)}})),i.changeValue=i.changeField=i.setValue,i}(this))}ke(nt.prototype,{initData:function(e){ke(this,{ctxs:{},fieldCtx:{},nameCtx:{},sort:[],rules:e})},init:function(){this.updateAppendData(),this.useProvider(),this.usePage(),this.loadRule(),this.$manager.__init(),this.lifecycle("created")},updateAppendData:function(){this.appendData=S(S(S({},this.options.formData||{}),this.fc.vm.props.modelValue||{}),this.appendData)},isBreakWatch:function(){return this.loading||this.noWatchFn||this.reloading},globalBeforeFetch:function(e){var t=this;return new Promise((function(n,r){var i=t.options.beforeFetch&&be((function(){return t.options.beforeFetch(e,{api:t.api})}));i&&B.Function(i.then)?i.then(n).catch(r):n()}))},beforeFetch:function(e){var t=this;return new Promise((function(n,r){var i=e&&e.beforeFetch&&be((function(){return e.beforeFetch(e,{api:t.api})}));i&&B.Function(i.then)?i.then(n).catch(r):!1===i?r():n()})).then((function(){return t.globalBeforeFetch(e)}))},beforeSubmit:function(e){var t=this;return new Promise((function(n,r){var i=t.options.beforeSubmit&&be((function(){return t.options.beforeSubmit(e,{api:t.api})}));i&&B.Function(i.then)?i.then(n).catch(r):!1===i?r():n()}))}}),function(e){ke(e.prototype,{parseInjectEvent:function(e,t){var n=e.inject||this.options.injectEvent;return this.parseEventLst(e,t,n)},parseEventLst:function(e,t,n,r){var i=this;return Object.keys(t).forEach((function(a){var o=i.parseEvent(e,t[a],n,r);o&&(t[a]=o)})),t},parseEvent:function(e,t,n,r){if(B.Function(t)&&(!1!==n&&!B.Undef(n)||t.__inject))return this.inject(e,t,n);if(!r&&Array.isArray(t)&&t[0]&&(B.String(t[0])||B.Function(t[0])))return this.parseEventLst(e,t,n,!0);if(B.String(t)){var i=fe(t);if(i&&t!==i)return i.__inject?this.parseEvent(e,i,n,!0):i}},parseEmit:function(e){var t=this,n={},r=e.rule,i=r.emitPrefix,a=r.field,o=r.name,u=r.inject,c=r.emit||[];return B.trueArray(c)&&c.forEach((function(e){if(e){var c,l=i||a||o;if(B.Object(e)&&(c=e.inject,l=(e=e.name).prefix||l),l){var f=I("".concat(l,"-").concat(e)),s=function(){var e,n,r;t.vm.emitsOptions&&(t.vm.emitsOptions[f]=null);for(var i=arguments.length,a=new Array(i),o=0;o<i;o++)a[o]=arguments[o];(e=t.vm).emit.apply(e,[f].concat(a)),(n=t.vm).emit.apply(n,["emit-event",f].concat(a)),(r=t.bus).$emit.apply(r,[f].concat(a))};if(s.__emit=!0,c||!1!==u){var d=c||u||t.options.injectEvent;n[e]=B.Undef(d)?s:t.inject(r,s,d)}else n[e]=s}}})),e.computed.on=n,n},getInjectData:function(e,t){var n=e.__fc__&&e.__fc__.$api,r=(e.__fc__&&e.__fc__.$handle.vm||this.vm).props,i=r.option,a=r.rule;return{$f:n||this.api,api:n||this.api,rule:a,self:e.__origin__,option:i,inject:t}},inject:function(e,t,n){if(t.__origin){if(this.watching&&!this.loading)return t;t=t.__origin}var r=this,i=function(){for(var i=r.getInjectData(e,n),a=arguments.length,o=new Array(a),u=0;u<a;u++)o[u]=arguments[u];return i.args=[].concat(o),o.unshift(i),t.apply(this,o)};return i.__origin=t,i.__json=t.__json,i},loadStrVar:function(e,t,n){var r=this;if(e&&"string"==typeof e&&e.indexOf("{{")>-1&&e.indexOf("}}")>-1){var i,a=e,o=function(e){for(var t,n=/{{\s*(.*?)\s*}}/g,r={};null!==(t=n.exec(e));)t[1]&&(r[t[1]]=!0);return Object.keys(r)}(e),u=function e(i){var a=[];i.forEach((function(t){t.key?a.push(t.key):t.children&&a.push(e(t.children))}));var o=!1;return a.forEach((function(e,t){null==e||0!==e.indexOf("'")&&0!==e.indexOf('"')||(a[t]=e.slice(1,-1),o=!0)})),1!==a.length||!o&&isNaN(Number(a[0]))?function(e){var i,a=!1;if(n&&0===e.indexOf("$form.")){var o=e.split(".");o.shift(),G(n.value,o[0])&&(a=!0,i=t?t({id:"$form."+o[0]+"_"+n.rule.__fc__.id,getValue:function(){return Se(n.value,o)}}):Se(n.value,o))}return a||(i=t?t(e):r.fc.getLoadData(e)),i}(a.join(".")):a[0]};if(o.forEach((function(t){var n=t.split("||"),r=n[0].trim();if(r){var a=(n[1]||"").trim(),o=Fe(r),c=be((function(){return u(o)}));(null==c||""===c)&&n.length>1&&(c=a),i=c,e=e.replaceAll("{{".concat(t,"}}"),null==c?"":c)}})),1===o.length&&a==="{{".concat(o[0],"}}"))return i}return e},loadFetchVar:function(e,t,n){var r,i=this;n&&n.__fc__&&(r=n.__fc__.getParentGroup());var a=function(e){return i.loadStrVar(e,t,r?{rule:n,value:i.subRuleData[r.id]||{}}:null)};return e.action=a(e.action||""),["headers","data","query"].forEach((function(t){if(e[t]){var n={};Object.keys(e[t]).forEach((function(r){n[a(r)]=a(e[t][r])})),e[t]=n}})),e}})}(nt),function(e){ke(e.prototype,{usePage:function(){var e=this,t=this.options.page;if(t){var n,r=25,i=(n=this.rules).length<31?31:Math.ceil(n.length/3);B.Object(t)&&(t.first&&(r=parseInt(t.first,10)||r),t.limit&&(i=parseInt(t.limit,10)||i)),ke(this,{first:r,limit:i,pageEnd:this.rules.length<=r}),this.bus.$on("page-end",(function(){return e.vm.emit("page-end",e.api)})),this.pageLoad()}},pageLoad:function(){var e=this;this.bus.$on(ze,(function t(){e.pageEnd?(e.bus.$off(ze,t),e.bus.$emit("page-end")):(e.first+=e.limit,e.pageEnd=e.rules.length<=e.first,e.loadRule(),e.refresh())}))}})}(nt),function(e){ke(e.prototype,{clearNextTick:function(){this.nextTick&&clearTimeout(this.nextTick),this.nextTick=null},bindNextTick:function(e){var t=this;this.clearNextTick(),this.nextTick=setTimeout((function(){e(),t.nextTick=null}),10)},render:function(){return++this.loadedId,this.vm.setupState.unique>0?this.$render.render():(this.vm.setupState.unique=1,[])}})}(nt),function(e){ke(e.prototype,{nextRefresh:function(e){var t=this,n=this.loadedId;p((function(){n===t.loadedId&&(e?e():t.refresh())}))},parseRule:function(e){var t=this,n=me(e);return Object.defineProperties(n,{__origin__:de(e,!0)}),function(e){var t={props:{},on:{},options:[],children:[],hidden:!1,display:!0,value:void 0};Object.keys(t).forEach((function(n){G(e,n)||(e[n]=t[n])}))}(n),this.appendValue(n),[n,n.prefix,n.suffix].forEach((function(e){e&&t.loadFn(e,n)})),this.loadCtrl(n),n.update&&(n.update=fe(n.update)),n},loadFn:function(e,t){var n=this;["on","props","deep"].forEach((function(r){e[r]&&n.parseInjectEvent(t,e[r])}))},loadCtrl:function(e){e.control&&e.control.forEach((function(e){e.handle&&(e.handle=fe(e.handle))}))},syncProp:function(e){var t=this,n=e.rule;B.trueArray(n.sync)&&X([{on:n.sync.reduce((function(e,r){return e["object"===j(r)&&r.event||"update:".concat(r)]=function(e){n.props["object"===j(r)&&r.prop||r]=e,t.vm.emit("sync",r,e,n,t.fapi)},e}),{})}],e.computed)},loadRule:function(){var e=this;this.cycleLoad=!1,this.loading=!0,this.pageEnd&&this.bus.$emit("load-start"),this.deferSyncValue((function(){if(e._loadRule(e.rules),e.loading=!1,e.cycleLoad&&e.pageEnd)return e.loadRule();e.syncForm(),e.pageEnd&&e.bus.$emit("load-end"),e.vm.setupState.renderRule()}))},loadChildren:function(e,t){if(this.cycleLoad=!1,this.loading=!0,this.bus.$emit("load-start"),this._loadRule(e,t),this.loading=!1,this.cycleLoad)return this.loadRule();this.syncForm(),this.bus.$emit("load-end"),this.$render.clearCache(t)},_loadRule:function(e,t){var n=this,r=function t(r){var i=e[r-1];if(!i||!i.__fc__)return r>0?t(r-1):-1;var a=n.sort.indexOf(i.__fc__.id);return a>-1?a:t(r-1)},i=function(e,t){B.trueArray(e)&&n._loadRule(e,t)},a=e.map((function(a,o){if((!t||B.Object(a))&&(n.pageEnd||t||!(o>=n.first))){if(a.__fc__&&a.__fc__.root===e&&n.ctxs[a.__fc__.id])return i(a.__fc__.loadChildrenPending(),a.__fc__),a.__fc__;var u,c=me(a),l=function(){return!(!c.field||!n.fieldCtx[c.field]||n.fieldCtx[c.field][0]===a.__fc__)};n.fc.targetFormDriver("loadRule",{rule:c,api:n.api},n.fc),n.ruleEffect(c,"init",{repeat:l()}),l()&&n.vm.emit("repeat-field",a,n.api);var f=!1,s=!!a.__fc__,d=c.value;if(s)if(d=(u=a.__fc__).defaultValue,u.deleted){if(Ze(u))return;u.update(n)}else if(!u.check(n)){if(Ze(u))return;e[o]=a=a._clone?a._clone():se(ce(a)),u=null,f=!0}if(u)u.originType!==u.rule.type&&u.updateType(),n.bindParser(u),n.appendValue(u.rule),u.parent&&u.parent!==t&&n.rmSubRuleData(u);else{var p=n.parseRule(a);u=new Ke(n,p,d),n.bindParser(u)}n.parseEmit(u),n.syncProp(u),u.parent=t||null,u.root=e,n.setCtx(u),f||s||(n.effect(u,"load"),n.targetHook(u,"load")),n.effect(u,"created");var h=u.loadChildrenPending();if(!1===u.parser.loadChildren||i(h,u),!t){var v=r(o);v>-1||!o?n.sort.splice(v+1,0,u.id):n.sort.push(u.id)}var m=u.rule;return u.updated||(u.updated=!0,B.Function(m.update)&&n.bus.$once("load-end",(function(){n.refreshUpdate(u,m.value,"init")})),n.effect(u,"loaded")),n.refreshControl(u)&&(n.cycleLoad=!0),u}})).filter((function(e){return!!e}));t&&(t.children=a)},refreshControl:function(e){return e.input&&e.rule.control&&this.useCtrl(e)},useCtrl:function(e){var t=this,n=function(e){var t=e.rule.control||[];return B.Object(t)?[t]:t}(e),r=[],i=this.api;if(!n.length)return!1;for(var a=function(t){var a=n[t],o=a.handle||function(e){return(Ce[a.condition||"=="]||Ce["=="])(e,a.value)};if(!B.trueArray(a.rule))return"continue";var u=S(S({},a),{},{valid:be((function(){return o(e.rule.value,i)})),ctrl:Xe(e,a.rule),isHidden:B.String(a.rule[0])});if(u.valid&&u.ctrl||!u.valid&&!u.ctrl&&!u.isHidden)return"continue";r.push(u)},o=0;o<n.length;o++)a(o);if(!r.length)return!1;var u=[],c=!1;return this.deferSyncValue((function(){r.reverse().forEach((function(n){var r=n.isHidden,a=n.valid,o=n.rule,l=n.prepend,f=n.append,s=n.child,d=n.ctrl,p=n.method;if(r)return a?e.ctrlRule.push({__ctrl:!0,children:o,valid:a}):d&&e.ctrlRule.splice(e.ctrlRule.indexOf(d)>>>0,1),void u[a?"push":"unshift"]((function(){"disabled"===p||"enabled"===p?t.api.disabled(!a,o):"display"===p||"show"===p?t.api.display(a,o):"required"===p?(o.forEach((function(e){t.api.setEffect(e,"required",a)})),a||t.api.clearValidateState(o)):t.api.hidden(!a,o)}));if(a){c=!0;var h={type:"fragment",native:!0,__ctrl:!0,children:o};e.ctrlRule.push(h),t.bus.$once("load-start",(function(){l?i.prepend(h,l,s):f||s?i.append(h,f||e.id,s):e.root.splice(e.root.indexOf(e.origin)+1,0,h)}))}else{e.ctrlRule.splice(e.ctrlRule.indexOf(d),1);var v=ye(d);v&&v.rm()}}))})),u.length&&(this.loading?u.length&&this.bus.$once("load-end",(function(){u.forEach((function(e){return e()}))})):u.length&&p((function(){u.forEach((function(e){return e()}))}))),this.vm.emit("control",e.origin,this.api),this.effect(e,"control"),c},reloadRule:function(e){return this._reloadRule(e)},_reloadRule:function(e){var t=this;e||(e=this.rules);var n=S({},this.ctxs);this.clearNextTick(),this.initData(e),this.fc.rules=e,this.deferSyncValue((function(){t.bus.$once("load-end",(function(){Object.keys(n).filter((function(e){return void 0===t.ctxs[e]})).forEach((function(e){return t.rmCtx(n[e])})),t.$render.clearCacheAll()})),t.reloading=!0,t.loadRule(),t.reloading=!1,t.refresh(),t.bus.$emit("reloading",t.api)})),this.bus.$off("next-tick",this.nextReload),this.bus.$once("next-tick",this.nextReload),this.bus.$emit("update",this.api)},refresh:function(){this.vm.setupState.refresh()}})}(nt),function(e){ke(e.prototype,{setValue:function(e,t,n,r){var i=this;e.deleted||(e.rule.value=t,this.changeStatus=!0,this.nextRefresh(),this.$render.clearCache(e),this.setFormData(e,n),this.syncValue(),this.valueChange(e,t),this.vm.emit("change",e.field,t,e.origin,this.api,r||!1),this.effect(e,"value"),this.targetHook(e,"value",{value:t}),this.emitEvent("change",e.field,t,{rule:e.origin,api:this.api,setFlag:r||!1}),r&&p((function(){p((function(){p((function(){i.api.clearValidateState(e.id)}))}))})),this.$manager.fieldChange(e,t,n,r))},onInput:function(e,t){var n;e.input&&(this.isQuote(e,n=e.parser.toValue(t,e))||this.isChange(e,t))&&this.setValue(e,n,t)},onUpdateValue:function(e,t){var n=this;this.deferSyncValue((function(){var r=e.getParentGroup(),i=r?n.subRuleData[r.id]:null,a={};Object.keys(t||{}).forEach((function(e){i&&G(i,e)?a[e]=t[e]:G(n.api.form,e)?n.api.form[e]=t[e]:n.api.top!==n.api&&G(n.api.top.form,e)&&(n.api.top.form[e]=t[e])})),Object.keys(a).length&&n.api.setChildrenFormData(r.rule,a)}))},onBaseInput:function(e,t){this.setFormData(e,t),e.modelValue=t,this.nextRefresh(),this.$render.clearCache(e)},setFormData:function(e,t){e.modelValue=t;var n=e.getParentGroup();n&&(this.subRuleData[n.id]||(this.subRuleData[n.id]={}),this.subRuleData[n.id][e.field]=e.rule.value),q(this.formData,e.id,t)},rmSubRuleData:function(e){var t=e.getParentGroup();t&&this.subRuleData[t.id]&&delete this.subRuleData[t.id][e.field]},getFormData:function(e){return this.formData[e.id]},syncForm:function(){var e=this,t=o({}),n=this.fields(),r=[];!1!==this.options.appendValue&&Object.keys(this.appendData).reduce((function(t,r){return-1===n.indexOf(r)&&(t[r]=m(e.appendData,r)),t}),t),n.reduce((function(t,n){var i=(e.fieldCtx[n]||[]).filter((function(t){return!e.isIgnore(t)}))[0];return i||(i=e.fieldCtx[n][0],r.push(n)),t[n]=m(i.rule,"value"),t}),t),this.form=t,this.ignoreFields=r,this.syncValue()},isIgnore:function(e){return!0===e.rule.ignore||("hidden"===e.rule.ignore||this.options.ignoreHiddenFields)&&e.hasHidden()},appendValue:function(e){(e.field&&G(this.appendData,e.field)||this.options.forceCoverValue)&&(e.value=this.appendData[e.field],delete this.appendData[e.field])},addSubForm:function(e,t){this.subForm[e.id]=t},deferSyncValue:function(e,t){this.deferSyncFn||(this.deferSyncFn=e),this.deferSyncFn.sync||(this.deferSyncFn.sync=t),be(e),this.deferSyncFn===e&&(this.deferSyncFn=null,e.sync&&this.syncForm())},syncValue:function(){var e=this;if(this.deferSyncFn)return this.deferSyncFn.sync=!0;var t={};Object.keys(this.form).forEach((function(n){-1===e.ignoreFields.indexOf(n)&&(t[n]=e.form[n])})),this.vm.setupState.updateValue(t)},isChange:function(e,t){return JSON.stringify(this.getFormData(e),Qe)!==JSON.stringify(t,Qe)},isQuote:function(e,t){return(t instanceof Function||B.Object(t)||Array.isArray(t))&&t===e.rule.value},refreshUpdate:function(e,t,n,r){var i=this;if(B.Function(e.rule.update)){var a=be((function(){return e.rule.update(t,e.origin,i.api,{origin:n||"change",linkField:r})}));if(void 0===a)return;e.rule.hidden=!0===a}},valueChange:function(e,t){this.refreshRule(e,t),this.bus.$emit("change-"+e.field,t)},refreshRule:function(e,t,n,r){this.refreshControl(e)&&(this.$render.clearCacheAll(),this.loadRule(),this.bus.$emit("update",this.api),this.refresh()),this.refreshUpdate(e,t,n,r)},appendLink:function(e){var t=this,n=e.rule.link;B.trueArray(n)&&n.forEach((function(n){var r=function(){return t.refreshRule(e,e.rule.value,"link",n)};t.bus.$on("change-"+n,r),e.linkOn.push((function(){return t.bus.$off("change-"+n,r)}))}))},fields:function(){return Object.keys(this.fieldCtx)}})}(nt),function(e){ke(e.prototype,{getCtx:function(e){return this.getFieldCtx(e)||this.getNameCtx(e)[0]||this.ctxs[e]},getCtxs:function(e){return this.fieldCtx[e]||this.nameCtx[e]||(this.ctxs[e]?[this.ctxs[e]]:[])},setIdCtx:function(e,t,n){var r="".concat(n,"Ctx");this[r][t]?this[r][t].push(e):this[r][t]=[e]},rmIdCtx:function(e,t,n){var r="".concat(n,"Ctx"),i=this[r][t];if(!i)return!1;var a=i.splice(i.indexOf(e)>>>0,1).length>0;return i.length||delete this[r][t],a},getFieldCtx:function(e){return(this.fieldCtx[e]||[])[0]},getNameCtx:function(e){return this.nameCtx[e]||[]},setCtx:function(e){var t=e.id,n=e.field,r=e.name,i=e.rule;this.ctxs[t]=e,r&&this.setIdCtx(e,r,"name"),e.input&&(this.setIdCtx(e,n,"field"),this.setFormData(e,e.parser.toFormValue(i.value,e)),this.isMounted&&!this.reloading&&this.vm.emit("change",e.field,i.value,e.origin,this.api))},getParser:function(e){var t=this.fc.parsers,n=this.fc.renderDriver;if(n){var r=n.parsers||{},i=r[e.originType]||r[ie(e.type)]||r[e.trueType];if(i)return i}return t[e.originType]||t[ie(e.type)]||t[e.trueType]||Ye},bindParser:function(e){e.setParser(this.getParser(e))},getType:function(e){var t=this.fc.CreateNode.aliasMap,n=t[e]||t[ie(e)]||e;return ie(n)},noWatch:function(e){this.noWatchFn||(this.noWatchFn=e),be(e),this.noWatchFn===e&&(this.noWatchFn=null)},watchCtx:function(e){var t=this;if(te().filter((function(e){return"_"!==e[0]&&"$"!==e[0]&&-1===et.indexOf(e)})).forEach((function(n){var r=m(e.rule,n),i="children"===n;e.refRule[n]=r,e.watch.push(d(i?function(){return B.Function(r.value)?r.value:V(r.value||[])}:function(){return r.value},(function(a,o){var u=r.value;if(!t.isBreakWatch()){if(i&&!1===e.parser.loadChildren)return t.$render.clearCache(e),void t.nextRefresh();if(t.watching=!0,p((function(){t.targetHook(e,"watch",{key:n,oldValue:o,newValue:u})})),"hidden"===n&&Boolean(u)!==Boolean(o)&&(t.$render.clearCacheAll(),p((function(){t.targetHook(e,"hidden",{value:u})}))),"ignore"===n&&e.input||"hidden"===n&&e.input&&("hidden"===e.rule.ignore||t.options.ignoreHiddenFields))t.syncForm();else{if("link"===n)return void e.link();["props","on","deep"].indexOf(n)>-1?(t.parseInjectEvent(e.rule,u||{}),"props"===n&&e.input&&t.setFormData(e,e.parser.toFormValue(e.rule.value,e))):"emit"===n?t.parseEmit(e):["prefix","suffix"].indexOf(n)>-1?u&&t.loadFn(u,e.rule):"type"===n?(e.updateType(),t.bindParser(e)):i&&(B.Function(o)&&(o=e.getPending("children",[])),B.Function(u)&&(u=e.loadChildrenPending()),t.updateChildren(e,u,o))}t.$render.clearCache(e),t.refresh(),t.watching=!1}}),{deep:!i,sync:i}))})),e.refRule.__$title=v((function(){var n=("object"===j(e.rule.title)?e.rule.title.title:e.rule.title)||"";if(n){var r=n.match(/^\{\{\s*\$t\.(.+)\s*\}\}$/);r&&(n=t.api.t(r[1]))}return n})),e.refRule.__$info=v((function(){var n=("object"===j(e.rule.info)?e.rule.info.info:e.rule.info)||"";if(n){var r=n.match(/^\{\{\s*\$t\.(.+)\s*\}\}$/);r&&(n=t.api.t(r[1]))}return n})),e.refRule.__$validate=v((function(){var n=function(n){var r,i,a=n.match(/^\{\{\s*\$t\.(.+)\s*\}\}$/);return a?t.api.t(a[1],{title:null===(r=e.refRule)||void 0===r||null===(i=r.__$title)||void 0===i?void 0:i.value}):n};return N(e.rule.validate).map((function(r){var i=S({},r);if(i.message&&(i.message=n(i.message)),B.Function(i.validator)){var a=e;i.validator=function(){for(var e,t=arguments.length,n=new Array(t),i=0;i<t;i++)n[i]=arguments[i];return(e=r.validator).call.apply(e,[{that:this,id:a.id,field:a.field,rule:a.rule,api:a.$handle.api}].concat(n))}}if(i.adapter){if("object"===j(i.error)){var o=S({},i.error);Object.keys(o).forEach((function(e){o[e]=n(o[e])})),i.error=o}return t.adapterValidate(i,e)}return i}))})),e.input){var n=m(e.rule,"value");e.watch.push(d((function(){return n.value}),(function(){var r=e.parser.toFormValue(n.value,e);t.isChange(e,r)&&t.setValue(e,n.value,r,!0)})))}this.bus.$once("load-end",(function(){var n=e.rule.computed;n&&("object"!==j(n)&&(n={value:n}),Object.keys(n).forEach((function(r){var i=v((function(){var i=n[r];if(i){var a=t.compute(e,i);return i.linkage&&a===tt?tt:a}})),a=function(n){"value"===r?t.onInput(e,n):"$"===r[0]?t.api.setEffect(e.id,r,n):He(e.rule,r,n)};("value"===r?[void 0,null,""].indexOf(e.rule.value)>-1:i.value!==Se(e.rule,r))&&a(i.value),e.watch.push(d(i,(function(e){e!==tt&&setTimeout((function(){a(e)}))}),{deep:!0}))})))})),this.watchEffect(e)},adapterValidate:function(e,t){var n=this;return this.$manager.adapterValidate({required:e.required,message:e.message,target:e.trigger},(function(r,i){if(!1===(e.beforeValidate&&be((function(){return e.beforeValidate({value:r,api:n.api,validate:e,rule:t.rule})}))))i();else{var a=n.validator(t,r,e);if(a){var o="";"object"===j(e.error)&&(o=e.error[a]||e.error.default),o||"string"!=typeof e.message||(o=e.message),o||(o=n.getValidateMessage(t,{key:a,rule:e[a]})),i(o)}else if(e.validator){var u=e.validator&&be((function(){return e.validator(r,i)}));u&&B.Function(u.then)&&u.then((function(){return i()})).catch((function(e){return i(e)}))}else i()}}))},getValidateMessage:function(e,t){var n,r,i,a=Array.isArray(t.rule)?t.rule.join(","):""+t.rule;return this.api.t("required"===t.key?t.key:"validate."+t.key,(E(i={},t.key,a),E(i,"title",null===(n=e.refRule)||void 0===n||null===(r=n.__$title)||void 0===r?void 0:r.value),i))},validator:function(e,t,n){var r=this;if(B.empty(t))return n.required?"required":void 0;for(var i=function(){var n=R(o[a],2),i=n[0],u=n[1];switch(i){case"len":case"maxLen":case"minLen":var c=function(e){return"len"===i?e===u:"maxLen"===i?e<=u:e>=u};if(Array.isArray(t)){if(!c(t.length))return{v:i}}else{if("object"===j(t))return{v:i};if(!c((""+t).length))return{v:i}}break;case"pattern":if(!("string"==typeof u?new RegExp(u):u).test(""+t))return{v:i};break;case"uppercase":if(u&&("string"!=typeof t||!/^[A-Z]*$/.test(t)))return{v:i};break;case"lowercase":if(u&&("string"!=typeof t||!/^[a-z]*$/.test(t)))return{v:i};break;case"min":case"max":case"positive":case"negative":case"integer":case"number":var l=Number(t);if(Number.isNaN(l))return{v:i};if("min"===i&&l<u)return{v:i};if("max"===i&&l>u)return{v:i};if("positive"===i&&l<=0)return{v:i};if("negative"===i&&l>=0)return{v:i};if("integer"===i&&!Number.isInteger(l))return{v:i};break;case"equal":if(t!==u)return{v:i};break;case"enum":if(Array.isArray(u)&&!u.includes(t))return{v:i};break;case"hasKeys":if("object"!==j(t)||Array.isArray(u)&&u.some((function(e){return!(e in t)})))return{v:i};break;case"email":if(!/^(([^<>()\[\]\\.,;:\s@"]+(\.[^<>()\[\]\\.,;:\s@"]+)*)|(".+"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/.test(""+t))return{v:i};break;case"url":if(!new RegExp("^(?!mailto:)(?:(?:http|https|ftp)://)(?:\\S+(?::\\S*)?@)?(?:(?:(?:[1-9]\\d?|1\\d\\d|2[01]\\d|22[0-3])(?:\\.(?:1?\\d{1,2}|2[0-4]\\d|25[0-5])){2}(?:\\.(?:[0-9]\\d?|1\\d\\d|2[0-4]\\d|25[0-4]))|(?:(?:[a-z\\u00a1-\\uffff0-9]+-?)*[a-z\\u00a1-\\uffff0-9]+)(?:\\.(?:[a-z\\u00a1-\\uffff0-9]+-?)*[a-z\\u00a1-\\uffff0-9]+)*(?:\\.(?:[a-z\\u00a1-\\uffff]{2,})))|localhost)(?::\\d{2,5})?(?:(/|\\?|#)[^\\s]*)?$","i").test(""+t))return{v:i};break;case"ip":if(!/^(2(5[0-5]{1}|[0-4]\d{1})|[0-1]?\d{1,2})(\.(2(5[0-5]{1}|[0-4]\d{1})|[0-1]?\d{1,2})){3}$/.test(""+t))return{v:i};break;case"phone":if(!/^(?:(?:\+|00)86)?1[3-9]\d{9}$/.test(""+t))return{v:i};break;case"computed":if(!r.compute(e,u))return{v:i}}},a=0,o=Object.entries(n);a<o.length;a++){var u=i();if("object"===j(u))return u.v}},compute:function(e,t){var n,r=this;if("object"===j(t)){var i=e.getParentGroup(),a=function t(n){if(n=Array.isArray(n)?{mode:"AND",group:n}:n,!B.trueArray(n.group))return!0;for(var a="OR"===n.mode,o=!0,u=function(u){var c=n.group[u],l=void 0,f=null;if(c.variable)f=JSON.stringify(r.fc.getLoadData(c.variable)||"");else if(c.field)f=je(c.field||"");else if(!c.mode)return{v:!0};var s=c.compare;if(s&&(s=je(s||"")),l=c.mode?t(c):!!Ce[c.condition]&&(B.Function(c.handler)?be((function(){return c.handler(r.api,e.rule)})):be((function(){return new Function("$condition","$val","$form","$scope","$group","$rule","with($form){with($scope){with(this){with($group){ return $condition['".concat(c.condition,"'](").concat(f,", ").concat(s||"$val","); }}}}")).call(r.api.form,Ce,c.value,r.api.top.form,r.api.top===r.api.scope?{}:r.api.scope.form,i&&r.subRuleData[i.id]||{},e.rule)}))),a&&l)return{v:!0};a||(o=o&&l)},c=0;c<n.group.length;c++){var l=u(c);if("object"===j(l))return l.v}return!a&&o}(t);return a=!0===t.invert?!a:a,t.linkage?a?be((function(){return r.computeValue(t.linkage,e,i)}),void 0):tt:a}if(B.Function(t))n=function(){return t(r.api.form,r.api)};else{var o=e.getParentGroup();n=function(){return r.computeValue(t,e,o)}}return be(n,void 0)},computeValue:function(e,t,n){var r=this,i=this,a=Object.keys(this.fc.formulas).reduce((function(e,n){return e[n]=function(){for(var e,r=arguments.length,a=new Array(r),o=0;o<r;o++)a[o]=arguments[o];return(e=i.fc.formulas[n]).call.apply(e,[{that:this,rule:t.rule,api:i.api,fc:i.fc}].concat(a))},e}),{});return be((function(){return new Function("$formulas","$form","$scope","$group","$rule","$api","with($form){with($scope){with(this){with($group){with($formulas){ return ".concat(e," }}}}}")).call(r.api.form,a,r.api.top.form,r.api.top===r.api.scope?{}:r.api.scope.form,n&&r.subRuleData[n.id]||{},t.rule,r.api)}),void 0)},updateChildren:function(e,t,n){var r=this;this.deferSyncValue((function(){n&&n.forEach((function(n){-1===(t||[]).indexOf(n)&&n&&!B.String(n)&&n.__fc__&&n.__fc__.parent===e&&r.rmCtx(n.__fc__)})),B.trueArray(t)&&(r.loadChildren(t,e),r.bus.$emit("update",r.api))}))},rmSub:function(e){var t=this;B.trueArray(e)&&e.forEach((function(e){e&&e.__fc__&&t.rmCtx(e.__fc__)}))},rmCtx:function(e){var t=this;if(!e.deleted){var n=e.id,r=e.field,i=e.input,a=e.name;U(this.ctxs,n),U(this.formData,n),U(this.subForm,n),U(this.vm.setupState.ctxInject,n);var o=e.getParentGroup();o&&this.subRuleData[o.id]&&U(this.subRuleData[o.id],r),e.group&&U(this.subRuleData,n),i&&this.rmIdCtx(e,r,"field"),a&&this.rmIdCtx(e,a,"name"),i&&!G(this.fieldCtx,r)&&U(this.form,r),this.deferSyncValue((function(){if(!t.reloading){if(!1!==e.parser.loadChildren){var n=e.getPending("children",e.rule.children);B.trueArray(n)&&n.forEach((function(e){return e&&e.__fc__&&t.rmCtx(e.__fc__)}))}e.root===t.rules&&t.vm.setupState.renderRule()}}),i);var u=this.sort.indexOf(n);return u>-1&&this.sort.splice(u,1),this.$render.clearCache(e),e.delete(),this.effect(e,"deleted"),this.targetHook(e,"deleted"),i&&!this.fieldCtx[r]&&this.vm.emit("remove-field",r,e.rule,this.api),e.rule.__ctrl||this.vm.emit("remove-rule",e.rule,this.api),e}}})}(nt),function(e){ke(e.prototype,{mounted:function(){var e=this,t=function(){e.isMounted=!0,e.lifecycle("mounted")};this.pageEnd?t():this.bus.$once("page-end",t)},lifecycle:function(e){this.fc.targetFormDriver(e,this.api,this.fc),this.vm.emit(e,this.api),this.emitEvent(e,this.api)},emitEvent:function(e){for(var t,n=arguments.length,r=new Array(n>1?n-1:0),i=1;i<n;i++)r[i-1]=arguments[i];var a=this.options[e]||this.options[ie("on-"+e)];if(a){var o=fe(a);B.Function(o)&&be((function(){return o.apply(void 0,r)}))}(t=this.bus).$emit.apply(t,[e].concat(r))},targetHook:function(e,t,n){var r,i,a=this,o=function(t,r){t&&(t=Array.isArray(t)?t:[t]).forEach((function(t){be((function(){return t(S(S({},n||{}),{},{self:e.rule,rule:e.rule,parent:null==r?void 0:r.rule,$f:a.api,api:a.api,option:a.vm.props.option}))}))}))};o(null===(r=e.prop)||void 0===r||null===(i=r.hook)||void 0===i?void 0:i[t]);for(var u="deep"+M(t),c=e.parent;c;){var l,f;o(null===(l=c.prop)||void 0===l||null===(f=l.hook)||void 0===f?void 0:f[u],c),c=c.parent}}})}(nt),function(e){ke(e.prototype,{useProvider:function(){var e=this,t=this.fc.providers;Object.keys(t).forEach((function(n){var r=t[n];B.Function(r)&&(r=r(e.fc)),r._c=function(e){var t=e.components;if(Array.isArray(t)){var n=function(e){return e.filter((function(e,t,n){return n.indexOf(e,0)===t}))}(t.filter((function(e){return"*"!==e})));return!!n.length&&n}return!!B.String(t)&&[t]}(r),e.onEffect(r),e.providers[n]=r}))},onEffect:function(e){var t=this,n=[];(e._c||["*"]).forEach((function(r){var i="*"===r?"*":t.getType(r);n.indexOf(i)>-1||(n.push(i),t.bus.$on("p:".concat(e.name,":").concat(i,":").concat(e.input?1:0),(function(t,n){e[t]&&e[t].apply(e,V(n))})))})),e._used=n},watchEffect:function(e){var t=this,n={required:function(){var t,n;return(G(e.rule,"$required")?e.rule.$required:null===(t=e.rule)||void 0===t||null===(n=t.effect)||void 0===n?void 0:n.required)||!1}};Object.keys(e.rule.effect||{}).forEach((function(t){n[t]=function(){return e.rule.effect[t]}})),Object.keys(e.rule).forEach((function(t){"$"===t[0]&&(n[t.substr(1)]=function(){return e.rule[t]})})),Object.keys(n).forEach((function(r){e.watch.push(d(n[r],(function(n){t.effect(e,"watch",E({},r,n))}),{deep:!0}))}))},ruleEffect:function(e,t,n){this.emitEffect({rule:e,input:!!e.field,type:this.getType(e.type)},t,n)},effect:function(e,t,n){this.emitEffect({rule:e.rule,input:e.input,type:e.trueType,ctx:e,custom:n},t)},getEffect:function(e,t){return G(e,"$"+t)?e["$"+t]:G(e,"effect")&&G(e.effect,t)?e.effect[t]:void 0},emitEffect:function(e,t,n){var r=this,i=e.ctx,a=e.rule,o=e.input,u=e.type,c=e.custom;if(u&&!(["fcFragment","fragment"].indexOf(u)>-1)){var l=c||Object.keys(a).reduce((function(e,t){return"$"===t[0]&&(e[t.substr(1)]=a[t]),e}),S({},a.effect||{}));Object.keys(l).forEach((function(e){var c=r.providers[e];if(c&&(!c.input||o)){var f;if(c._c){if(!(c._used.indexOf(u)>-1))return;f=u}else f="*";var s=S({value:l[e],getValue:function(){return r.getEffect(a,e)}},n||{});i&&(s.getProp=function(){return i.effectData(e)},s.clearProp=function(){return i.clearEffectData(e)},s.mergeProp=function(e){return ve(s.getProp(),[e])},s.id=i.id),r.bus.$emit("p:".concat(e,":").concat(f,":").concat(c.input?1:0),t,[s,a,r.api])}}))}}})}(nt);var rt=t({name:"fcFragment",inheritAttrs:!1,props:["vnode"],render:function(){return this.vnode}});function it(e,t){var n=e.directives;return n?(Array.isArray(n)||(n=[n]),b(t,n.reduce((function(e,t){return e.concat(function(e){return Object.keys(e).map((function(t){var n=e[t],r=_(t);if(r)return[r,n.value,n.arg,n.modifiers]})).filter((function(e){return!!e}))}(t))}),[]))):t}function at(){var e={};function t(e){this.vm=e}return ke(t.prototype,{make:function(e,t,n){return it(t,this.h(e,$e(t),n))},makeComponent:function(e,t,n){try{return it(t,g(e,$e(t),n))}catch(e){return console.error(e),g("")}},h:function(e,t,r){var i=(this.vm||n()).appContext.config.isNativeTag(e);i&&delete t.formCreateInject;try{return g(i?e:y(e),t,r)}catch(e){return console.error(e),g("")}},aliasMap:e}),ke(t,{aliasMap:e,alias:function(t,n){e[t]=n},use:function(e){Object.keys(e).forEach((function(n){var r,i=I(n),a=(r=n,null==r?"":"object"===j(r)?JSON.stringify(r,null,2):String(r)).toLocaleLowerCase(),o=e[n];[n,i,a].forEach((function(e){t.alias(n,o),t.prototype[e]=function(e,t){return this.make(o,e,t)}}))}))}}),t}function ot(e){var t=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&D(e,t)}(n,ut);var t=A(n);function n(){return F(this,n),t.apply(this,arguments)}return n}();return Object.assign(t.prototype,e),t}function ut(e){ke(this,{$handle:e,vm:e.vm,options:{},ref:"fcForm",mergeOptionsRule:{normal:["form","row","info","submitBtn","resetBtn"]}}),this.updateKey(),this.init()}ke(ut.prototype,{__init:function(){var e=this;this.$render=this.$handle.$render,this.$r=function(){var t;return(t=e.$render).renderRule.apply(t,arguments)}},updateKey:function(){this.key=Ge()},init:function(){},update:function(){},beforeRender:function(){},form:function(){return this.vm.refs[this.ref]},adapterValidate:function(e,t){return e.validator=function(e,n,r){return t(n,r)},e},getSlot:function(e){return function t(n){if(n){var r=n.slots[e];return r||t(n.setupState.parent)}}(this.vm)},mergeOptions:function(e,t){var n=this;return X(e.map((function(e){return n.tidyOptions(e)})),t,this.mergeOptionsRule)},updateOptions:function(e){this.$handle.fc.targetFormDriver("updateOptions",e,{handle:this.$handle,api:this.$handle.api}),this.options=this.mergeOptions([e],this.getDefaultOptions()),this.update()},tidyOptions:function(e){return e},tidyRule:function(e){},mergeProp:function(e){},getDefaultOptions:function(){return{}},fieldChange:function(e,t,n,r){},render:function(e){}});var ct={name:"componentValidate",load:function(e,t,n){var r=e.getValue();if(r&&!1!==r.method){B.Object(r)||(r={method:r});var i=r.method,a=S(S({},r),{},{validator:function(){var r=ye(t);if(r){for(var a=arguments.length,o=new Array(a),u=0;u<a;u++)o[u]=arguments[u];return n.exec.apply(n,[r.id,B.String(i)?i:"formCreateValidate"].concat(o,[{attr:e,rule:t,api:n}]))}}});delete a.method,e.getProp().validate=[a]}else e.clearProp(),n.clearValidateState([t.field])},watch:function(){ct.load.apply(ct,arguments)}},lt={fetch:function(e){function t(t,r,i){var a=t.value;n.deleted(t),B.Function(a)&&(a=a(r,i)),a=function(e){return B.String(e)&&(e={action:e,to:"options"}),e}(a);var o=function(n){void 0===n?t.clearProp():He(t.getProp(),a.to||"options",n),null!=n&&a&&a.key&&e.$handle.options.globalData[a.key]&&e.fetchCache.set(e.$handle.options.globalData[a.key],{status:!0,data:n}),i.sync(r)};if(a&&(a.action||a.key)){if((a=J(a)).to||(a.to="options"),a.key){var u=e.$handle.options.globalData[a.key];if(!u)return void o(void 0);if("static"===u.type)return void o(u.data);a=S(S({},a),u)}var c=a.onError,l=function(){if(!t.getValue())return t.clearProp(),i.sync(r),!0};n._fn[t.id]=e.watchLoadData(T((function(u,f){if(f&&!1===a.watch)return n._fn[t.id]();var s=e.$handle.loadFetchVar(J(a),u,r),d=S(S({headers:{}},s),{},{onSuccess:function(e,t){if(!l()){var n=function(e){return t?e:G(e,"data")?e.data:e},a=fe(s.parse);B.Function(a)?n=a:a&&B.String(a)&&(n=function(e){return Se(e,a)}),o(n(e,r,i))}},onError:function(e){o(void 0),l()||(c||function(e){return re(e.message||"fetch fail "+s.action)})(e,r,i)}});e.$handle.beforeFetch(d,{rule:r,api:i}).then((function(){B.Function(s.action)?s.action(r,i).then((function(e){d.onSuccess(e,!0)})).catch((function(e){d.onError(e)})):be((function(){return e.create.fetch(d,{inject:t,rule:r,api:i})}))})).catch((function(e){}))}),a.wait||600))}else o(void 0)}var n={name:"fetch",_fn:[],loaded:function(){t.apply(void 0,arguments)},watch:function(){t.apply(void 0,arguments)},deleted:function(e){this._fn[e.id]&&(this._fn[e.id](),delete this._fn[e.id]),e.clearProp()}};return n},loadData:function(e){var t={name:"loadData",_fn:[],loaded:function(t,n,r){var i=this;this.deleted(t),p((function(){var a=N(t.getValue()),o=[];a.forEach((function(i){if(i&&(i.attr||i.template)){var a=function(a){var o,u;n&&n.__fc__&&(o=n.__fc__.getParentGroup()),null!=(u=i.template?e.$handle.loadStrVar(i.template,a,o?{rule:n,value:e.$handle.subRuleData[o.id]||{}}:null):i.handler&&B.Function(i.handler)?i.handler(a,n,r):e.$handle.loadStrVar("{{".concat(i.attr,"}}"),a,o?{rule:n,value:e.$handle.subRuleData[o.id]||{}}:null))&&""!==u||null==i.default||(u=i.default),!1!==i.copy&&(u=J(u));var c=i.modify?n:t.getProp();"child"===i.to?c.children?c.children[0]=u:c.children=[u]:He(c,i.to||"options",u),r.sync(n)},u=e.watchLoadData((function(e){return a(e)}));a=T(a,i.wait||300),!1!==i.watch?o.push(u):u()}})),i._fn[t.id]=o}))},deleted:function(e){this._fn[e.id]&&(this._fn[e.id].forEach((function(e){e()})),delete this._fn[e.id]),e.clearProp()}};return t.watch=t.loaded,t},t:function(e){var t={name:"t",_fn:[],loaded:function(t,n,r){this.deleted(t);var i=t.getValue()||{},a=[];Object.keys(i).forEach((function(o){var u=i[o];if(u){var c="object"===j(u),l=function(i){var a=e.t(c?u.attr:u,c?u.params:null,i),l=c&&u.modify?n:t.getProp();"child"===o?l.children?l.children[0]=a:l.children=[a]:He(l,o,a),r.sync(n)},f=e.watchLoadData((function(e){return l(e)}));l=T(l,u.wait||300),!1!==u.watch?a.push(f):f()}})),this._fn[t.id]=a},deleted:function(e){this._fn[e.id]&&(this._fn[e.id].forEach((function(e){e()})),delete this._fn[e.id]),e.clearProp()}};return t.watch=t.loaded,t},componentValidate:ct};function ft(e){e=e||new Map;var t={$on:function(t,n){var r=e.get(t);r&&r.push(n)||e.set(t,[n])},$once:function(e,n){n._once=!0,t.$on(e,n)},$off:function(t,n){var r=e.get(t);r&&r.splice(r.indexOf(n)>>>0,1)},$emit:function(n){for(var r=arguments.length,i=new Array(r>1?r-1:0),a=1;a<r;a++)i[a-1]=arguments[a];(e.get(n)||[]).slice().map((function(e){e._once&&(t.$off(n,e),delete e._once),e.apply(void 0,i)})),(e.get("*")||[]).slice().map((function(e){e(n,i)}))}};return t}var st={name:"html",loadChildren:!1,render:function(e,t){return t.prop.props.innerHTML=e.default(),t.vNode.make(t.prop.props.tag||"div",t.prop)},renderChildren:function(e){return{default:function(){return e.filter((function(e){return B.String(e)})).join("")}}}};function dt(e){e+="=";for(var t=decodeURIComponent(document.cookie).split(";"),n=0;n<t.length;n++){for(var r=t[n];" "===r.charAt(0);)r=r.substring(1);if(0===r.indexOf(e)){r=r.substring(e.length,r.length);try{return JSON.parse(r)}catch(e){return r}}}return null}function pt(e){var t=localStorage.getItem(e);if(t)try{return JSON.parse(t)}catch(e){return t}return null}function ht(e){var t=sessionStorage.getItem(e);if(t)try{return JSON.parse(t)}catch(e){return t}return null}function vt(e,t){if(!t)return null;var n=t.split("."),r=e(n.shift());return n.length?null==r?null:Se(r,n):r}function mt(e){return vt(dt,e)}function gt(e){return vt(pt,e)}function yt(e){return vt(ht,e)}var bt={en:{required:"{title} is required",validate:{url:"{title} is not a valid url",email:"{title} is not a valid email",ip:"{title} {title} is not a valid ip",phone:"{title} {title} is not a valid phone",pattern:"{title} does not match pattern {pattern}",uppercase:"{title} must be all uppercase",lowercase:"{title} must be all lowercased",positive:"{title} is not a positive number",negative:"{title} is not a negative number",equal:"{title} is not equal to {equal}",min:"{title} cannot be less than {min}",max:"{title} cannot be greater than {max}",enum:"{title} must be one of {enum}",hasKeys:"{title} does not contain required fields {hasKeys}",minLen:"{title} must be at least {minLen}",maxLen:"{title} cannot be longer than {maxLen}",len:"{title} must be exactly {len}",integer:"{title} is not an integer",number:"{title} is not an number"}},"zh-cn":{required:"{title}不能为空",validate:{url:"{title}不是有效的 url 地址",email:"{title}不是有效的邮箱地址",ip:"{title}不是有效的 IP 地址",phone:"{title}不是正确的手机号",pattern:"{title}必须匹配 {pattern}",uppercase:"{title}必须全大写",lowercase:"{title}必须全小写",positive:"{title}不是正数",negative:"{title}不是负数",equal:"{title}必须等于 {equal}",min:"{title}必须大于等于 {min}",max:"{title}必须小于等于 {max}",enum:"{title}必须是 {enum} 之一",hasKeys:"{title}必须包含 {hasKeys} 字段",minLen:"{title}长度必须大于 {minLen}",maxLen:"{title}长度必须小于 {maxLen}",len:"{title}长度必须为 {len}",integer:"{title}必须为整数",number:"{title}必须为数字"}}};function _t(e,t){var n;return 2===arguments.length?t=(n=arguments[1])[e]:n=arguments[2],{id:t,prop:n}}function $t(){return _t.apply(void 0,["name"].concat(Array.prototype.slice.call(arguments)))}var xt=1,Ot={},Ct=Symbol("defValue");function St(e){var t,n=E({},rt.name,rt),r={},i={},a={},u={},c=[],l=[],f=[e.extendApi],s=S({},lt),h=Te(),m={global:{}},g=!0===e.isMobile,y=o({$mobile:g}),b=at(),_={},C={};function F(e){var t=Ot[e];return Array.isArray(t)?t.map((function(e){return e.api()})):t?t.api():void 0}function w(e){c.push(e)}function D(){var e=$t.apply(void 0,arguments);e.id&&e.prop&&(i[e.id]=e.prop)}function k(){var e=$t.apply(void 0,arguments);e.id&&e.prop&&(s[e.id]=B.Function(e.prop)?e.prop:S(S({},e.prop),{},{name:e.id}))}function A(e){b.use(e)}function R(){var e=$t.apply(void 0,arguments);if(!e.id||!e.prop)return Ye;var t=ie(e.id),n=e.prop,i=!0===n.merge?r[t]:void 0;r[t]=xe(n,i||Ye),h[t]=Re(t),n.maker&&ke(h,n.maker)}function P(e,t){var i;if(B.String(e)){if(i=e,void 0===t)return n[i]}else i=e.displayName||e.name,t=e;if(i&&t){var a=ie(i);n[i]=t,n[a]=t,delete b.aliasMap[i],delete b.aliasMap[a],delete r[i],delete r[a],t.formCreateParser&&R(i,t.formCreateParser)}}function L(){return we(ae,n,i)}function N(){return rt}function I(e,t){return B.Function(e.install)?e.install(M,t):B.Function(e)&&e(M,t),this}function M(e,t){var n=function(e,t){var n=L();return $({data:function(){return o({rule:e,option:t})},render:function(){return x(n,S({ref:"fc"},this.$data))}})}(e,t||{});c.forEach((function(e){be((function(){return e(M,n)}))}));var r=document.createElement("div");return((null==t?void 0:t.el)||document.body).appendChild(r),n.mount(r).$refs.fc.fapi}function q(t){var o=S({},e);return t?o.inherit={components:n,parsers:r,directives:i,modelFields:a,providers:s,useApps:c,maker:h,formulas:_,loadData:y}:delete o.inherit,St(o)}function U(e,t){a[e]=t}function H(e,t){_[e]=t}function W(e,t){var n=u[e]||{},r=n.parsers||{};t.parsers&&Object.keys(t.parsers).forEach((function(e){r[e]=xe(t.parsers[e],Ye)})),t.name=e,u[e]=S(S(S({},n),t),{},{parsers:r})}function z(e){e&&Object.keys(Ot).forEach((function(t){(Array.isArray(Ot[t])?Ot[t]:[Ot[t]]).forEach((function(t){t.bus.$emit("$loadData."+e)}))}))}function K(e,t){He(y,e,t),z(e)}function X(e,t){var n=function(){for(var e=arguments.length,n=new Array(e),r=0;r<e;r++)n[r]=arguments[r];return be((function(){return t.apply(void 0,n)}))};n._driver=!0,K(e,n)}function Z(e,t){var n=(e||"").split(".");e=n.shift();var r=n.join(".");if(G(y,e)||(y[e]=Ct),y[e]!==Ct){var i=y[e];return i&&i._driver?i=i(r):n.length&&(i=Se(i,n)),null==i||""===i?t:i}return t}function te(e){f.push(e)}function ne(e){delete y[e],z(e)}function re(e,t){l.push({name:e,callback:t})}function ae(t){var c=this;ke(this,{id:xt++,create:M,vm:t,manager:ot(e.manager),parsers:r,providers:s,modelFields:a,formulas:_,isMobile:g,rules:t.props.rule,name:t.props.name||Ge(),inFor:t.props.inFor,prop:{components:n,directives:i},get:null,drivers:u,renderDriver:null,refreshData:z,loadData:y,CreateNode:b,bus:new ft,unwatch:[],options:O({}),extendApiFn:f,fetchCache:new WeakMap,tmpData:o({})}),l.forEach((function(e){c.bus.$on(e.name,e.callback)})),p((function(){d(c.options,(function(){c.$handle.$manager.updateOptions(c.options.value),c.api().refresh()}),{deep:!0})})),ke(t.appContext.components,n),ke(t.appContext.directives,i),this.$handle=new nt(this),this.name&&(this.inFor?(Ot[this.name]||(Ot[this.name]=[]),Ot[this.name].push(this)):Ot[this.name]=this)}function oe(t){ke(t,{version:e.version,ui:e.ui,isMobile:g,extendApi:te,getData:Z,setDataDriver:X,setData:K,removeData:ne,refreshData:z,maker:h,component:P,directive:D,setModelField:U,setFormula:H,setDriver:W,register:k,$vnode:N,parser:R,use:I,factory:q,componentAlias:A,copyRule:pe,copyRules:he,mergeRule:ve,fetch:Me,$form:L,parseFn:fe,parseJson:se,toJson:ce,useApp:w,getApi:F,on:re})}if(function(e){var t=e.key||[],n=e.array||[],r=e.normal||[];Q.push.apply(Q,V(t)),Y.push.apply(Y,V(n)),ee.push.apply(ee,V(r)),Pe([].concat(V(t),V(n),V(r)))}(e.attrs||{}),xe(M,C),ae.isMobile=g,ke(ae.prototype,{init:function(){var e=this;this.isSub()&&this.unwatch.push(d((function(){return e.vm.setupState.parent.setupState.fc.options.value}),(function(){e.initOptions(),e.$handle.api.refresh()}),{deep:!0})),this.vm.props.driver&&(this.renderDriver="object"===j(this.vm.props.driver)?this.vm.props.driver:this.drivers[this.vm.props.driver]),!this.renderDriver&&this.vm.setupState.parent&&(this.renderDriver=this.vm.setupState.parent.setupState.fc.renderDriver),this.renderDriver||(this.renderDriver=this.drivers.default),this.initOptions(),this.$handle.init()},targetFormDriver:function(e){for(var t=this,n=arguments.length,r=new Array(n>1?n-1:0),i=1;i<n;i++)r[i-1]=arguments[i];if(this.renderDriver&&this.renderDriver[e])return be((function(){var n;return(n=t.renderDriver)[e].apply(n,r)}))},t:function(e,t,n){var r=n?n("$t."+e):this.globalLanguageDriver(e);return null==r&&(r=""),r&&t&&Object.keys(t).forEach((function(e){var n=new RegExp("{".concat(e,"}"),"g");r=r.replace(n,t[e])})),r},globalDataDriver:function(e){var t=this,n=e.split("."),r=n.shift(),i=this.options.value.globalData&&this.options.value.globalData[r];if(i){if("static"===i.type)return Se(i.data,n);var a,o=this.fetchCache.get(i);if(o){if(o.status&&(a=Se(o.data,n)),!o.loading)return a;o.loading=!1,this.fetchCache.set(i,o)}else this.fetchCache.set(i,{status:!1});var u=T((function(){l();var e=t.fetchCache.get(i);t.options.value.globalData&&-1!==Object.values(t.options.value.globalData).indexOf(i)?(e&&(e.loading=!0,t.fetchCache.set(i,e)),t.bus.$emit("$loadData.$globalData."+r)):t.fetchCache.delete(i)}),i.wait||600),c=function(e){t.fetchCache.set(i,{status:!0,data:e}),t.bus.$emit("$loadData.$globalData."+r)},l=this.watchLoadData((function(e,n){if(n&&!1===i.watch)return l();if(n)u();else{var r=t.$handle.loadFetchVar(Ae(i),e);t.$handle.api.fetch(r).then((function(e){c(e)})).catch((function(e){c(null)}))}}));return this.unwatch.push(l),a}},getLocale:function(){var e=this.vm.setupState.top.props.locale;return e&&"object"===j(e)?e.name:"string"==typeof e?e:"zh-cn"},globalLanguageDriver:function(e){var t=this.vm.setupState.top.props.t,n=this.vm.setupState.top.props.locale,r=void 0;if(t&&(r=be((function(){return t(e)}))),null==r&&n&&"object"===j(n)&&(r=Se(n,e)),null==r){var i=this.options.value.language||{},a=this.getLocale();null==(r=Se(i[a]||{},e))&&(r=Se(bt[a]||{},e))}return r},globalVarDriver:function(e){var t=this,n=e.split("."),r=n.shift(),i=this.options.value.globalVariable&&this.options.value.globalVariable[r];if(i){var a=B.Function(i)?i:fe(i.handle);if(a){var o,u=this.watchLoadData((function(e,n){n?(t.bus.$emit("$loadData.$var."+r),u()):o=a(e,t.$handle.api)}));return this.unwatch.push(u),Se(o,n)}}},setData:function(e,t,n){n?K(e,t):(He(this.vm.setupState.top.setupState.fc.tmpData,e,t),this.bus.$emit("$loadData."+e))},getLoadData:function(e,t){var n=null;if(null!=e){var r=e.split("."),i=r.shift();if(null!=(n=Se(this.vm.setupState.top.setupState.fc.tmpData,e)))return n;if("$topForm"===i)n=this.$handle.api.top.formData(!0);else if("$scopeForm"===i)n=this.$handle.api.scope.formData(!0);else if("$form"===i)n=this.$handle.api.formData(!0);else if("$options"===i)n=this.options.value;else if("$globalData"===i)n=this.globalDataDriver(r.join(".")),r=[];else if("$var"===i)n=this.globalVarDriver(r.join(".")),r=[];else if("$locale"===i)n=this.getLocale(),r=[];else if("$t"===i)n=this.globalLanguageDriver(r.join(".")),r=[];else{if("$preview"===i)return this.$handle.preview;n=Z(e),r=[]}n&&r.length&&(n=Se(n,r))}return null==n||""===n?t:n},watchLoadData:function(e,t){var n=this,r={},i=function(t){n.get||(n.get=a),be((function(){e(a,t)})),n.get===a&&(n.get=void 0)},a=function(e,a){var o;if("object"===j(e)&&(o=e.getValue,e=e.id),r[e])return r[e].val;var u=v((function(){return o?o():n.getLoadData(e,a)})),c=e.split("."),l=c.shift(),f=c.shift()||"",s=T((function(){var t=o?o():n.getLoadData(e,a);r[e]&&((t instanceof Function||B.Object(t)||Array.isArray(t))&&t===r[e].val||JSON.stringify(t)!==JSON.stringify(r[e].val))&&(r[e].val=t,i(!0))}),t||0),p=d(u,(function(e){s()}));return n.bus.$on("$loadData."+l,s),f&&n.bus.$on("$loadData."+l+"."+f,s),r[e]={fn:function(){n.bus.$off("$loadData."+l,s),f&&n.bus.$off("$loadData."+l+"."+f,s),p()},val:u.value},u.value};i(!1);var o=function(){Object.keys(r).forEach((function(e){return r[e].fn()})),r={}};return this.unwatch.push(o),o},isSub:function(){return this.vm.setupState.parent&&this.vm.props.extendOption},initOptions:function(){this.options.value={};var e=S({formData:{},submitBtn:{},resetBtn:{},globalEvent:{},globalData:{}},J(m));this.isSub()&&(e=this.mergeOptions(e,this.vm.setupState.parent.setupState.fc.options.value||{},!0)),e=this.mergeOptions(e,this.vm.props.option),this.updateOptions(e)},mergeOptions:function(e,t,n){return t=S({},t||{}),n&&["page","onSubmit","onReset","onCreated","onChange","onMounted","mounted","onReload","reload","formData","el","globalClass","style"].forEach((function(e){delete t[e]})),t.global&&(e.global=function(e,t){return e?(Object.keys(t||{}).forEach((function(n){t[n]&&(e[n]=ve(e[n]||{},t[n]))})),e):t}(e.global,t.global),delete t.global),this.$handle.$manager.mergeOptions([t],e),e},updateOptions:function(e){this.options.value=this.mergeOptions(this.options.value,e),this.$handle.$manager.updateOptions(this.options.value),this.bus.$emit("$loadData.$options")},api:function(){return this.$handle.api},render:function(){return this.$handle.render()},mounted:function(){this.$handle.mounted()},unmount:function(){var e=this;if(this.name)if(this.inFor){var t=Ot[this.name].indexOf(this);Ot[this.name].splice(t,1)}else delete Ot[this.name];l.forEach((function(t){e.bus.$off(t.name,t.callback)})),this.tmpData={},this.unwatch.forEach((function(e){return e()})),this.unwatch=[],this.$handle.reloadRule([])},updated:function(){var e=this;this.$handle.bindNextTick((function(){return e.bus.$emit("next-tick",e.$handle.api)}))}}),oe(C),ke(t=C,{create:M,install:function(n,r){m=S(S({},m),r||{});var i="_installedFormCreate_"+e.ui;if(!0!==n[i]){n[i]=!0;var a=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return M(e,t)};oe(a),n.config.globalProperties.$formCreate=a;var o=L();n.component(o.name,o),c.forEach((function(e){be((function(){return e(t,n)}))}))}}}),X("$cookie",mt),X("$localStorage",gt),X("$sessionStorage",yt),b.use({fragment:"fcFragment"}),e.install&&M.use(e),w((function(e,t){t.mixin({props:["formCreateInject"]})})),R(st),e.inherit){var ue=e.inherit;ue.components&&ke(n,ue.components),ue.parsers&&ke(r,ue.parsers),ue.directives&&ke(i,ue.directives),ue.modelFields&&ke(a,ue.modelFields),ue.providers&&ke(s,ue.providers),ue.useApps&&ke(c,ue.useApps),ue.maker&&ke(h,ue.maker),ue.loadData&&ke(y,ue.loadData),ue.formulas&&ke(_,ue.formulas)}var le=L();return xe(le,C),Object.defineProperties(le,{fetch:{get:function(){return C.fetch},set:function(e){C.fetch=e}}}),le.util=C,le}export{Ve as Creator,ut as Manager,pe as copyRule,he as copyRules,Re as creatorFactory,St as default,rt as fragment,ve as mergeRule,se as parseJson,ce as toJson};
